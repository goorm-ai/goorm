# GoORM è®¾è®¡æ–‡æ¡£

> ä¸€ä¸ª **AI åŸç”Ÿ**ã€çœŸæ­£å¥½ç”¨çš„ Go è¯­è¨€ ORM æ¡†æ¶

---

## ç›®å½•

1. [é¡¹ç›®æ„¿æ™¯](#é¡¹ç›®æ„¿æ™¯)
2. [æ ¸å¿ƒç—›ç‚¹åˆ†æ](#æ ¸å¿ƒç—›ç‚¹åˆ†æ)
3. [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
4. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
5. [è¿ç§»ç³»ç»Ÿè®¾è®¡](#è¿ç§»ç³»ç»Ÿè®¾è®¡)
6. [CRUD API è®¾è®¡](#crud-api-è®¾è®¡)
7. [å…³è”å…³ç³»è®¾è®¡](#å…³è”å…³ç³»è®¾è®¡)
8. [å¤šæ•°æ®åº“æ”¯æŒ](#å¤šæ•°æ®åº“æ”¯æŒ)
9. [**AI å‹å¥½è®¾è®¡**](#ai-å‹å¥½è®¾è®¡) â­ æ ¸å¿ƒç‰¹æ€§
10. [**å®‰å…¨è®¾è®¡**](#å®‰å…¨è®¾è®¡) ğŸ”’ å…³é”®æ¨¡å—
11. [å¼€å‘è·¯çº¿å›¾](#å¼€å‘è·¯çº¿å›¾)
12. [è®¾è®¡å†³ç­–](#è®¾è®¡å†³ç­–)

---

## é¡¹ç›®æ„¿æ™¯

### ä¸€å¥è¯æè¿°

**è®© Go è¯­è¨€çš„æ•°æ®åº“æ“ä½œåƒå†™ JSON ä¸€æ ·ç®€å•ï¼Œè®©è¿ç§»åƒ Git ä¸€æ ·å¯é ï¼Œè®© AI åƒç†è§£äººç±»è¯­è¨€ä¸€æ ·ç†è§£ä½ çš„æ•°æ®åº“ã€‚**

### ç›®æ ‡ç”¨æˆ·

- åŒå€¦äº† GORM/Ent è¿ç§»é—®é¢˜çš„ Go å¼€å‘è€…
- éœ€è¦åœ¨ MySQL å’Œ PostgreSQL ä¹‹é—´çµæ´»åˆ‡æ¢çš„é¡¹ç›®
- è¿½æ±‚ä»£ç ç®€æ´æ€§å’Œå¼€å‘æ•ˆç‡çš„å›¢é˜Ÿ
- **æ„å»º AI åº”ç”¨ã€éœ€è¦ LLM ä¸æ•°æ®åº“äº¤äº’çš„å¼€å‘è€…**
- **å¸Œæœ›ç”¨è‡ªç„¶è¯­è¨€æ“ä½œæ•°æ®åº“çš„å›¢é˜Ÿ**

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 

| ç—›ç‚¹ | GoORM è§£å†³æ–¹æ¡ˆ |
|------|---------------|
| è¿ç§»åªåŠ ä¸å‡ï¼Œè¡¨ç»“æ„æ··ä¹± | **å®Œå…¨åŒæ­¥**ï¼šæ¨¡å‹ = æ•°æ®åº“ï¼Œå¤šä½™çš„è‡ªåŠ¨å¤‡ä»½åˆ é™¤ |
| CRUD æ“ä½œç¹çé‡å¤ | **ç®€æ´ API**ï¼šä¸€è¡Œä»£ç å®Œæˆå¸¸è§æ“ä½œ |
| å…³è”æŸ¥è¯¢å¤æ‚éš¾æ‡‚ | **å£°æ˜å¼å…³è”**ï¼šåœ¨æ¨¡å‹ä¸­å®šä¹‰ï¼ŒæŸ¥è¯¢æ—¶è‡ªåŠ¨å¤„ç† |
| å¤šæ•°æ®åº“é€‚é…éº»çƒ¦ | **ç»Ÿä¸€æŠ½è±¡**ï¼šPostgreSQL/MySQL æ— ç¼åˆ‡æ¢ |
| AI éš¾ä»¥ç†è§£æ•°æ®åº“ç»“æ„ | **Schema è‡ªæè¿°**ï¼šæ¨¡å‹è‡ªå¸¦è¯­ä¹‰ï¼ŒAI å¯ç†è§£ |
| LLM æ“ä½œæ•°æ®åº“å›°éš¾ | **è‡ªç„¶è¯­è¨€æŸ¥è¯¢**ï¼šNL â†’ SQLï¼Œæ”¯æŒ MCP åè®® |
| è¯­ä¹‰æœç´¢éœ€è¦é¢å¤–é›†æˆ | **å‘é‡åŸç”Ÿ**ï¼šå†…ç½® Embedding å’Œå‘é‡æœç´¢ |

---

## æ ¸å¿ƒç—›ç‚¹åˆ†æ

### GORM çš„é—®é¢˜

```go
// 1. AutoMigrate åªåŠ ä¸å‡
db.AutoMigrate(&User{})  
// åˆ é™¤äº† User.Phone å­—æ®µï¼Ÿæ•°æ®åº“é‡Œè¿˜åœ¨ï¼
// æ”¹äº†å­—æ®µç±»å‹ï¼Ÿä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼
// æ”¹äº†å­—æ®µåï¼Ÿä¼šåˆ›å»ºæ–°åˆ—ï¼Œæ—§åˆ—è¿˜åœ¨ï¼

// 2. å…³è”æŸ¥è¯¢ç¹ç
db.Preload("Posts").Preload("Posts.Comments").Preload("Profile").Find(&user)
// æ¯æ¬¡éƒ½è¦å†™ä¸€å † Preload

// 3. é“¾å¼è°ƒç”¨å®¹æ˜“å‡ºé”™
db.Model(&User{}).Where("age > ?", 18).Updates(...)  
// å¿˜äº† Model() å°±å…¨è¡¨æ›´æ–°äº†ï¼
```

### Ent çš„é—®é¢˜

```go
// 1. ä»£ç ç”Ÿæˆå¤æ‚
// æ”¹ä¸ªå­—æ®µè¦é‡æ–°ç”Ÿæˆï¼ŒIDE æ”¯æŒä¸å¥½

// 2. å­¦ä¹ æ›²çº¿é™¡å³­
client.User.Query().
    Where(user.AgeGT(18)).
    WithPosts(func(q *ent.PostQuery) {
        q.Where(post.StatusEQ("published"))
    }).
    All(ctx)
// è¯­æ³•ç‹¬ç‰¹ï¼Œä¸å¤Ÿç›´è§‚

// 3. è¿ç§»æ–‡ä»¶ç®¡ç†å¤æ‚
```

---

## è®¾è®¡åŸåˆ™

### 1. æ¨¡å‹å³çœŸç›¸ (Model as Single Source of Truth)

```
Go ç»“æ„ä½“å®šä¹‰ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º æ•°æ®åº“ç»“æ„
     â”‚                                  â”‚
     â”‚         å®Œå…¨ä¸€è‡´                 â”‚
     â”‚                                  â”‚
     â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**è§„åˆ™ï¼š**
- æ•°æ®åº“ç»“æ„å¿…é¡»ä¸ Go æ¨¡å‹ 100% ä¸€è‡´
- æ¨¡å‹ä¸­ä¸å­˜åœ¨çš„å­—æ®µ/è¡¨ = åº”è¯¥ä»æ•°æ®åº“ä¸­åˆ é™¤ï¼ˆå¤‡ä»½åï¼‰
- æ²¡æœ‰"å¢é‡è¿ç§»"çš„æ¦‚å¿µï¼Œåªæœ‰"åŒæ­¥"

### 2. å®‰å…¨ç¬¬ä¸€ (Safety First)

```
åˆ é™¤/ä¿®æ”¹æ“ä½œ â”€â”€â–º è‡ªåŠ¨å¤‡ä»½ â”€â”€â–º æ‰§è¡Œå˜æ›´ â”€â”€â–º è®°å½•å†å²
```

**è§„åˆ™ï¼š**
- ä»»ä½•ç ´åæ€§æ“ä½œå‰å¿…é¡»å¤‡ä»½
- æ‰€æœ‰è¿ç§»æ“ä½œå¯è¿½æº¯ã€å¯å›æ»š
- æä¾› dry-run é¢„è§ˆæ¨¡å¼

### 3. ç®€æ´ä¼˜äºçµæ´» (Simple over Flexible)

```go
// âŒ ä¸è¦è¿™æ ·ï¼ˆGORM é£æ ¼ï¼‰
db.Model(&User{}).Where("id = ?", 1).Updates(map[string]interface{}{"name": "new"})

// âœ… åº”è¯¥è¿™æ ·ï¼ˆGoORM é£æ ¼ï¼‰
db.User.Update(1, {"name": "new"})
```

**è§„åˆ™ï¼š**
- å¸¸è§æ“ä½œä¸€è¡Œä»£ç å®Œæˆ
- API è®¾è®¡éµå¾ªæœ€å°‘æƒŠè®¶åŸåˆ™
- 90% çš„åœºæ™¯ä¸éœ€è¦æŸ¥æ–‡æ¡£

### 4. æ˜¾å¼ä¼˜äºéšå¼ (Explicit over Implicit)

```go
// âŒ éšå¼è¡Œä¸ºï¼ˆå±é™©ï¼‰
db.Where("status = ?", "deleted").Delete(&User{})  // æ¡ä»¶åœ¨å“ªï¼Ÿå®¹æ˜“é—æ¼

// âœ… æ˜¾å¼è¡Œä¸ºï¼ˆå®‰å…¨ï¼‰
db.User.Where("status = ?", "deleted").Delete()  // æ˜ç¡®æ“ä½œçš„æ˜¯ User è¡¨
```

### 5. é›¶é…ç½®å¯åŠ¨ (Zero Config Start)

```go
// è¿æ¥æ•°æ®åº“ï¼Œè‡ªåŠ¨è¯†åˆ«ç±»å‹
db := goorm.Connect("postgres://user:pass@localhost/mydb")

// æ³¨å†Œæ¨¡å‹ï¼Œè‡ªåŠ¨åŒæ­¥ç»“æ„
db.Register(&User{}, &Post{}, &Comment{})
db.AutoSync()

// å¼€å§‹ä½¿ç”¨
users := db.User.All()
```

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åº”ç”¨å±‚ (Application Layer)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   db.User   â”‚  â”‚   db.Post   â”‚  â”‚ db.Comment  â”‚   ...       â”‚
â”‚  â”‚   .Find()   â”‚  â”‚  .Create()  â”‚  â”‚  .Where()   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ ¸å¿ƒå±‚ (Core Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Query Builder                          â”‚  â”‚
â”‚  â”‚  SELECT / INSERT / UPDATE / DELETE / JOIN                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Schema Parser  â”‚  â”‚  Migration Eng  â”‚  â”‚ Relation Mgr   â”‚  â”‚
â”‚  â”‚  è§£æ Go ç»“æ„ä½“ â”‚  â”‚  æ‰§è¡Œæ•°æ®åº“è¿ç§» â”‚  â”‚ ç®¡ç†å…³è”å…³ç³»   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ–¹è¨€å±‚ (Dialect Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     PostgreSQL æ–¹è¨€     â”‚  â”‚        MySQL æ–¹è¨€            â”‚  â”‚
â”‚  â”‚  - ç±»å‹æ˜ å°„             â”‚  â”‚  - ç±»å‹æ˜ å°„                  â”‚  â”‚
â”‚  â”‚  - DDL ç”Ÿæˆ             â”‚  â”‚  - DDL ç”Ÿæˆ                  â”‚  â”‚
â”‚  â”‚  - ç‰¹æ®Šè¯­æ³•             â”‚  â”‚  - ç‰¹æ®Šè¯­æ³•                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åº“å±‚ (Database Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      PostgreSQL         â”‚  â”‚          MySQL               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—

```
goorm/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ db.go           # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ model.go        # åŸºç¡€æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ registry.go     # æ¨¡å‹æ³¨å†Œè¡¨
â”‚
â”œâ”€â”€ schema/
â”‚   â”œâ”€â”€ parser.go       # è§£æ Go ç»“æ„ä½“ â†’ Schema
â”‚   â”œâ”€â”€ field.go        # å­—æ®µå®šä¹‰
â”‚   â”œâ”€â”€ table.go        # è¡¨å®šä¹‰
â”‚   â””â”€â”€ relation.go     # å…³è”å®šä¹‰
â”‚
â”œâ”€â”€ migrate/
â”‚   â”œâ”€â”€ sync.go         # åŒæ­¥å¼•æ“ï¼ˆæ ¸å¿ƒï¼ï¼‰
â”‚   â”œâ”€â”€ diff.go         # å·®å¼‚å¯¹æ¯”
â”‚   â”œâ”€â”€ backup.go       # å¤‡ä»½ç®¡ç†
â”‚   â”œâ”€â”€ history.go      # è¿ç§»å†å²
â”‚   â””â”€â”€ executor.go     # SQL æ‰§è¡Œå™¨
â”‚
â”œâ”€â”€ query/
â”‚   â”œâ”€â”€ builder.go      # æŸ¥è¯¢æ„å»ºå™¨
â”‚   â”œâ”€â”€ chain.go        # é“¾å¼è°ƒç”¨
â”‚   â”œâ”€â”€ where.go        # æ¡ä»¶æ„å»º
â”‚   â””â”€â”€ relation.go     # å…³è”åŠ è½½
â”‚
â”œâ”€â”€ dialect/
â”‚   â”œâ”€â”€ dialect.go      # æ–¹è¨€æ¥å£
â”‚   â”œâ”€â”€ postgres.go     # PostgreSQL å®ç°
â”‚   â””â”€â”€ mysql.go        # MySQL å®ç°
â”‚
â””â”€â”€ goorm.go            # å…¥å£æ–‡ä»¶
```

---

## è¿ç§»ç³»ç»Ÿè®¾è®¡

### æ ¸å¿ƒç†å¿µ

> **"æ•°æ®åº“ç»“æ„æ˜¯æ¨¡å‹çš„å½±å­ï¼Œå½±å­å¿…é¡»è·Ÿéšä¸»äººã€‚"**

### è¿ç§»æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AutoSync() æµç¨‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  1. è§£ææ¨¡å‹    â”‚
                    â”‚  Go ç»“æ„ä½“ â†’    â”‚
                    â”‚  å†…å­˜ Schema    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  2. è¯»å–æ•°æ®åº“  â”‚
                    â”‚  INFORMATION_   â”‚
                    â”‚  SCHEMA â†’ å½“å‰  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  3. å¯¹æ¯”å·®å¼‚    â”‚
                    â”‚  Diff(æœŸæœ›,å½“å‰)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼              â–¼              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ æ–°å¢çš„è¡¨  â”‚  â”‚ æ–°å¢çš„åˆ—  â”‚  â”‚ åˆ é™¤çš„è¡¨  â”‚
       â”‚ /åˆ—       â”‚  â”‚ ç±»å‹å˜æ›´  â”‚  â”‚ /åˆ—       â”‚
       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚              â”‚
             â–¼              â–¼              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  CREATE   â”‚  â”‚   ALTER   â”‚  â”‚  å¤‡ä»½æ•°æ® â”‚
       â”‚  TABLE/   â”‚  â”‚   TABLE   â”‚  â”‚  ç„¶å     â”‚
       â”‚  COLUMN   â”‚  â”‚   MODIFY  â”‚  â”‚  DROP     â”‚
       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚              â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  4. æ‰§è¡Œè¿ç§»    â”‚
                   â”‚  åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  5. è®°å½•å†å²    â”‚
                   â”‚  ä¿å­˜åˆ°         â”‚
                   â”‚  _goorm_history â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·®å¼‚æ£€æµ‹

```go
type SchemaDiff struct {
    // æ–°å¢
    TablesToCreate  []Table
    ColumnsToAdd    []Column
    IndexesToCreate []Index
    
    // ä¿®æ”¹
    ColumnsToModify []ColumnChange  // ç±»å‹ã€é•¿åº¦ã€é»˜è®¤å€¼ç­‰å˜æ›´
    
    // åˆ é™¤ï¼ˆéœ€è¦å¤‡ä»½ï¼‰
    TablesToDrop    []Table
    ColumnsToDrop   []Column
    IndexesToDrop   []Index
}

type ColumnChange struct {
    Table      string
    Column     string
    OldType    string
    NewType    string
    OldDefault any
    NewDefault any
    // ...
}
```

### å¤‡ä»½ç­–ç•¥

```
åˆ é™¤è¡¨æ—¶å¤‡ä»½:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users    â”‚ â”€â”€â–º â”‚ _backup_users_20260203_1508 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ é™¤åˆ—æ—¶å¤‡ä»½:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ users.phone (è¦åˆ é™¤)   â”‚ â”€â”€â–º â”‚ _backup_users_phone_20260203_1508  â”‚
â”‚                        â”‚     â”‚  id | phone                        â”‚
â”‚                        â”‚     â”‚  1  | 13800138000                  â”‚
â”‚                        â”‚     â”‚  2  | 13900139000                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿ç§»å†å²è¡¨

```sql
CREATE TABLE _goorm_migrations (
    id          SERIAL PRIMARY KEY,
    version     VARCHAR(32) NOT NULL,      -- æ—¶é—´æˆ³ç‰ˆæœ¬å·
    checksum    VARCHAR(64) NOT NULL,      -- Schema æ ¡éªŒå’Œ
    operations  JSONB NOT NULL,            -- æ‰§è¡Œçš„æ“ä½œ
    backups     JSONB,                     -- å¤‡ä»½ä¿¡æ¯
    executed_at TIMESTAMP DEFAULT NOW(),
    duration_ms INTEGER,
    success     BOOLEAN DEFAULT TRUE
);
```

### è¿ç§»å‘½ä»¤

```go
// è‡ªåŠ¨åŒæ­¥ï¼ˆå¼€å‘ç¯å¢ƒæ¨èï¼‰
db.AutoSync()

// é¢„è§ˆæ¨¡å¼ï¼ˆæŸ¥çœ‹å°†è¦æ‰§è¡Œçš„æ“ä½œï¼‰
diff := db.SyncPreview()
fmt.Println(diff.SQL())       // æ‰“å° SQL
fmt.Println(diff.Summary())   // æ‰“å°æ‘˜è¦

// å¼ºåˆ¶åŒæ­¥ï¼ˆä¸å¤‡ä»½ï¼Œè°¨æ…ä½¿ç”¨ï¼‰
db.AutoSync(goorm.WithoutBackup())

// åªå¤‡ä»½ä¸åˆ é™¤ï¼ˆä¿å®ˆæ¨¡å¼ï¼‰
db.AutoSync(goorm.KeepDeprecated())

// å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
db.RollbackTo("20260203150800")
```

---

## CRUD API è®¾è®¡

### æ ¸å¿ƒç†å¿µï¼šAI-Firstï¼ˆAI ä¼˜å…ˆï¼‰

> **æ‰€æœ‰ API è®¾è®¡ä»¥ AI èƒ½ç›´æ¥ç”Ÿæˆä¸ºé¦–è¦ç›®æ ‡**

```
ä¼ ç»Ÿ ORMï¼šäººç±»å†™ä»£ç  â†’ ä»£ç æ“ä½œæ•°æ®åº“
GoORMï¼š   AI ç”Ÿæˆ JSON â†’ JSON æ“ä½œæ•°æ®åº“ â†’ äººç±»å¯é€‰ä»‹å…¥
```

### è®¾è®¡åŸåˆ™

1. **JSON å³ API**ï¼šæ‰€æœ‰æ“ä½œéƒ½å¯ç”¨ JSON è¡¨è¾¾
2. **è‡ªç„¶è¯­è¨€å…¥å£**ï¼šå¤æ‚æŸ¥è¯¢ç”¨è‡ªç„¶è¯­è¨€æè¿°
3. **ç»“æ„åŒ–ä¼˜äºå­—ç¬¦ä¸²**ï¼šé¿å… SQL ç‰‡æ®µï¼Œä½¿ç”¨ç»“æ„åŒ–æ¡ä»¶
4. **æ— æ­§ä¹‰**ï¼šAI ç”Ÿæˆçš„æŸ¥è¯¢ä¸åº”æœ‰å¤šç§è§£é‡Š

### æŸ¥è¯¢è¯­æ³•ï¼šJSON Query Language (JQL)

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ ¸å¿ƒæ¦‚å¿µï¼šæ‰€æœ‰æŸ¥è¯¢éƒ½æ˜¯ JSON ç»“æ„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// JQL æŸ¥è¯¢ç»“æ„
type Query struct {
    Table   string                 `json:"table"`             // è¡¨å
    Action  string                 `json:"action"`            // find, create, update, delete, count
    Where   []Condition            `json:"where,omitempty"`   // æ¡ä»¶
    Data    map[string]any         `json:"data,omitempty"`    // æ•°æ®ï¼ˆç”¨äº create/updateï¼‰
    OrderBy []Order                `json:"order_by,omitempty"`// æ’åº
    Limit   int                    `json:"limit,omitempty"`   // é™åˆ¶
    Offset  int                    `json:"offset,omitempty"`  // åç§»
    Select  []string               `json:"select,omitempty"`  // é€‰æ‹©å­—æ®µ
    With    []string               `json:"with,omitempty"`    // åŠ è½½å…³è”
}

type Condition struct {
    Field string `json:"field"`          // å­—æ®µå
    Op    string `json:"op"`             // æ“ä½œç¬¦: =, !=, >, <, >=, <=, in, like, null, not_null
    Value any    `json:"value"`          // å€¼
    Or    bool   `json:"or,omitempty"`   // æ˜¯å¦ OR è¿æ¥
}

type Order struct {
    Field string `json:"field"` // å­—æ®µå
    Desc  bool   `json:"desc"`  // æ˜¯å¦é™åº
}
```

### åŸºç¡€ CRUDï¼ˆAI ç›´æ¥ç”Ÿæˆ JSONï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CREATE - åˆ›å»º
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// AI ç”Ÿæˆçš„ JSON
result := db.Execute(`{
    "table": "users",
    "action": "create",
    "data": {
        "name": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "age": 25
    }
}`)
// â†’ {"id": 1, "affected": 1}

// æ‰¹é‡åˆ›å»º
result := db.Execute(`{
    "table": "users",
    "action": "create_batch",
    "data": [
        {"name": "å¼ ä¸‰", "email": "a@example.com"},
        {"name": "æå››", "email": "b@example.com"}
    ]
}`)
// â†’ {"ids": [1, 2], "affected": 2}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// READ - æŸ¥è¯¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ ¹æ® ID æŸ¥è¯¢
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "=", "value": 1}]
}`)
// â†’ {"data": [{"id": 1, "name": "å¼ ä¸‰", ...}], "count": 1}

// å¤æ‚æ¡ä»¶æŸ¥è¯¢
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [
        {"field": "age", "op": ">", "value": 18},
        {"field": "status", "op": "=", "value": "active"}
    ],
    "order_by": [{"field": "created_at", "desc": true}],
    "limit": 10,
    "offset": 0
}`)

// OR æ¡ä»¶
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [
        {"field": "age", "op": ">", "value": 30},
        {"field": "vip", "op": "=", "value": true, "or": true}
    ]
}`)
// â†’ WHERE age > 30 OR vip = true

// IN æŸ¥è¯¢
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "in", "value": [1, 2, 3]}]
}`)

// ç»Ÿè®¡
result := db.Execute(`{
    "table": "users",
    "action": "count",
    "where": [{"field": "status", "op": "=", "value": "active"}]
}`)
// â†’ {"count": 42}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPDATE - æ›´æ–°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ ¹æ® ID æ›´æ–°
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "data": {"name": "æ–°åå­—", "age": 30}
}`)
// â†’ {"affected": 1}

// æ‰¹é‡æ›´æ–°
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "status", "op": "=", "value": "inactive"}],
    "data": {"deleted_at": "2026-02-03T15:30:00Z"}
}`)
// â†’ {"affected": 15}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ é›¶å€¼æ›´æ–°ï¼ˆå½»åº•è§£å†³ GORM çš„ç—›ç‚¹ï¼ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
GORM çš„é—®é¢˜ï¼šé›¶å€¼ï¼ˆ0, "", falseï¼‰ä¸ä¼šæ›´æ–°
db.Model(&user).Updates(User{Age: 0})  // âŒ GORM ä¸æ›´æ–°ï¼

GORM éœ€è¦ç¹ççš„è§£å†³æ–¹æ¡ˆï¼š
db.Model(&user).Updates(map[string]any{"age": 0})       // ç”¨ map
db.Model(&user).Select("Age").Updates(User{Age: 0})    // æ˜¾å¼ Select
*/

// âœ… JQL å¤©ç„¶è§£å†³ï¼šJSON ä¸­æœ‰å­—æ®µ = è¦æ›´æ–°ï¼Œæ²¡å­—æ®µ = ä¸æ›´æ–°

// æ›´æ–° age ä¸º 0ï¼ˆé›¶å€¼ï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "data": {"age": 0}
}`)
// â†’ âœ… age ä¼šè¢«æ›´æ–°ä¸º 0

// æ›´æ–° is_vip ä¸º falseï¼ˆé›¶å€¼ï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "data": {"is_vip": false}
}`)
// â†’ âœ… is_vip ä¼šè¢«æ›´æ–°ä¸º false

// æ›´æ–° name ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆé›¶å€¼ï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "data": {"name": ""}
}`)
// â†’ âœ… name ä¼šè¢«æ›´æ–°ä¸ºç©ºå­—ç¬¦ä¸²

// æ›´æ–°å­—æ®µä¸º null
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "data": {"deleted_at": null}
}`)
// â†’ âœ… deleted_at ä¼šè¢«æ›´æ–°ä¸º NULL

// åªæ›´æ–°éƒ¨åˆ†å­—æ®µï¼ˆå…¶ä»–å­—æ®µä¸å˜ï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "update",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "data": {"name": "æ–°åå­—"}
}`)
// â†’ âœ… åªæ›´æ–° nameï¼Œå…¶ä»–å­—æ®µï¼ˆage, status ç­‰ï¼‰ä¿æŒä¸å˜


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELETE - åˆ é™¤
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ ¹æ® ID åˆ é™¤
result := db.Execute(`{
    "table": "users",
    "action": "delete",
    "where": [{"field": "id", "op": "=", "value": 1}]
}`)
// â†’ {"affected": 1}

// æ‰¹é‡åˆ é™¤ï¼ˆä¼šè¿”å› pending_confirmï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "delete",
    "where": [{"field": "status", "op": "=", "value": "deleted"}]
}`)
// â†’ {"status": "pending_confirm", "affected": 100, "confirm_token": "..."}
```

### è‡ªç„¶è¯­è¨€å…¥å£ï¼ˆç»ˆæç®€åŒ–ï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è‡ªç„¶è¯­è¨€ â†’ è‡ªåŠ¨è½¬æ¢ä¸º JQL â†’ æ‰§è¡Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æŸ¥è¯¢
result := db.NL("æŸ¥æ‰¾æ‰€æœ‰18å²ä»¥ä¸Šçš„VIPç”¨æˆ·ï¼ŒæŒ‰æ³¨å†Œæ—¶é—´å€’åºï¼Œå–å‰10ä¸ª")
/*
å†…éƒ¨è½¬æ¢ä¸ºï¼š
{
    "table": "users",
    "action": "find",
    "where": [
        {"field": "age", "op": ">", "value": 18},
        {"field": "vip", "op": "=", "value": true}
    ],
    "order_by": [{"field": "created_at", "desc": true}],
    "limit": 10
}
*/

// ç»Ÿè®¡
result := db.NL("ç»Ÿè®¡æ¯ä¸ªéƒ¨é—¨æœ‰å¤šå°‘äºº")
/*
{
    "table": "users",
    "action": "aggregate",
    "group_by": ["dept_id"],
    "select": ["dept_id", {"count": "*", "as": "count"}]
}
*/

// åˆ›å»º
result := db.NL("åˆ›å»ºä¸€ä¸ªåå«å¼ ä¸‰ã€é‚®ç®±æ˜¯zhangsan@qq.comçš„ç”¨æˆ·")
/*
{
    "table": "users",
    "action": "create",
    "data": {"name": "å¼ ä¸‰", "email": "zhangsan@qq.com"}
}
*/

// æ›´æ–°
result := db.NL("æŠŠæ‰€æœ‰ä¸‰å¹´æ²¡ç™»å½•çš„ç”¨æˆ·çŠ¶æ€æ”¹ä¸º inactive")
/*
{
    "table": "users",
    "action": "update",
    "where": [{"field": "last_login_at", "op": "<", "value": "2023-02-03"}],
    "data": {"status": "inactive"}
}
*/

// åˆ é™¤ï¼ˆä¼šè¿”å›ç¡®è®¤ï¼‰
result := db.NL("åˆ é™¤æ‰€æœ‰å·²åˆ é™¤çŠ¶æ€çš„ç”¨æˆ·")
/*
{
    "table": "users",
    "action": "delete",
    "where": [{"field": "status", "op": "=", "value": "deleted"}]
}
â†’ {"status": "pending_confirm", ...}
*/
```

### å“åº”æ ¼å¼ï¼ˆAI å‹å¥½çš„ç»“æ„åŒ–è¾“å‡ºï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ‰€æœ‰å“åº”éƒ½æ˜¯ç»“æ„åŒ– JSON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æŸ¥è¯¢æˆåŠŸ
{
    "success": true,
    "data": [...],                  // æŸ¥è¯¢ç»“æœ
    "meta": {
        "table": "users",
        "action": "find",
        "count": 10,                // è¿”å›è¡Œæ•°
        "total": 100,               // æ€»è¡Œæ•°ï¼ˆå¦‚æœæŸ¥è¯¢äº†ï¼‰
        "duration_ms": 5,           // æ‰§è¡Œæ—¶é—´
        "sql": "SELECT ...",        // ç”Ÿæˆçš„ SQLï¼ˆè°ƒè¯•ç”¨ï¼‰
    }
}

// å†™å…¥æˆåŠŸ
{
    "success": true,
    "affected": 1,                  // å½±å“è¡Œæ•°
    "id": 123,                      // æ–°å»ºçš„ IDï¼ˆå¦‚æœæ˜¯ createï¼‰
    "ids": [123, 124],              // æ‰¹é‡æ–°å»ºçš„ ID
    "operation_id": "op_abc123",    // æ“ä½œ IDï¼ˆå¯ç”¨äºæ’¤é”€ï¼‰
    "backup_table": "_backup_..."   // å¤‡ä»½è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰
}

// éœ€è¦ç¡®è®¤
{
    "success": false,
    "status": "pending_confirm",
    "message": "æ­¤æ“ä½œå°†åˆ é™¤ 100 æ¡è®°å½•",
    "affected": 100,
    "preview": [...],               // å‰ 5 æ¡å°†è¢«å½±å“çš„æ•°æ®
    "confirm_token": "cfm_xyz",
    "expires_at": "2026-02-03T15:35:00Z"
}

// é”™è¯¯
{
    "success": false,
    "error": {
        "code": "FK_VIOLATION",
        "message": "å¤–é”®çº¦æŸå¤±è´¥",
        "details": {...},
        "suggestion": "å…ˆåˆ›å»ºå…³è”çš„è®°å½•",
        "auto_fix": {
            "action": "create_related",
            "query": {...}
        }
    }
}
```

### Go ç±»å‹å®‰å…¨å°è£…ï¼ˆå¯é€‰ï¼Œç»™äººç±»ç”¨ï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¦‚æœäººç±»æƒ³è¦ç±»å‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Go å°è£…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// è¿™äº›åªæ˜¯ JSON çš„ Go å°è£…ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢ä¸º JSON æ‰§è¡Œ
result := db.Query(goorm.Q{
    Table:  "users",
    Action: goorm.Find,
    Where: []goorm.Cond{
        {Field: "age", Op: goorm.Gt, Value: 18},
        {Field: "status", Op: goorm.Eq, Value: "active"},
    },
    OrderBy: []goorm.Order{{Field: "created_at", Desc: true}},
    Limit:   10,
})

// æˆ–è€…ç”¨æ„å»ºå™¨ï¼ˆä¾ç„¶è½¬æ¢ä¸º JSONï¼‰
result := db.Table("users").
    Find().
    Where("age", goorm.Gt, 18).
    Where("status", goorm.Eq, "active").
    OrderBy("created_at", goorm.Desc).
    Limit(10).
    Exec()
```

### é«˜çº§æŸ¥è¯¢ï¼ˆJQL é£æ ¼ï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¤æ‚æ¡ä»¶ï¼ˆåµŒå¥— AND/ORï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åµŒå¥—æ¡ä»¶ç»„
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": {
        "and": [
            {"field": "status", "op": "=", "value": "active"},
            {
                "or": [
                    {"field": "age", "op": ">", "value": 30},
                    {"field": "vip", "op": "=", "value": true}
                ]
            }
        ]
    }
}`)
// â†’ WHERE status = 'active' AND (age > 30 OR vip = true)

// IN æŸ¥è¯¢
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "in", "value": [1, 2, 3]}]
}`)

// BETWEEN
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "age", "op": "between", "value": [18, 30]}]
}`)

// LIKE
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "name", "op": "like", "value": "%å¼ %"}]
}`)

// NULL æ£€æŸ¥
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "deleted_at", "op": "null"}]
}`)


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// èšåˆæŸ¥è¯¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åˆ†ç»„ç»Ÿè®¡
result := db.Execute(`{
    "table": "users",
    "action": "aggregate",
    "select": ["status", {"fn": "count", "as": "count"}],
    "group_by": ["status"],
    "having": [{"fn": "count", "op": ">", "value": 10}]
}`)
// â†’ SELECT status, COUNT(*) as count FROM users GROUP BY status HAVING COUNT(*) > 10

// èšåˆå‡½æ•°
result := db.Execute(`{
    "table": "orders",
    "action": "aggregate",
    "select": [
        {"fn": "sum", "field": "amount", "as": "total"},
        {"fn": "avg", "field": "amount", "as": "average"},
        {"fn": "max", "field": "amount", "as": "max_order"},
        {"fn": "min", "field": "amount", "as": "min_order"}
    ],
    "where": [{"field": "user_id", "op": "=", "value": 1}]
}`)


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¤šè¡¨å…³è”æŸ¥è¯¢ï¼ˆJOINï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åŠ è½½å…³è”ï¼ˆé¢„åŠ è½½ï¼Œæ¨èï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "with": ["profile", "posts"]
}`)
// â†’ è‡ªåŠ¨åŠ è½½ user.profile å’Œ user.posts

// åµŒå¥—å…³è”
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "with": ["posts.comments", "posts.tags"]
}`)
// â†’ åŠ è½½ user.postsï¼Œä»¥åŠæ¯ä¸ª post çš„ comments å’Œ tags

// å¸¦æ¡ä»¶çš„å…³è”åŠ è½½
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "with": [
        {
            "relation": "posts",
            "where": [{"field": "status", "op": "=", "value": "published"}],
            "order_by": [{"field": "created_at", "desc": true}],
            "limit": 5
        }
    ]
}`)

// æ˜¾å¼ JOINï¼ˆé«˜çº§ç”¨æ³•ï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "join": [
        {
            "table": "orders",
            "type": "left",
            "on": {"users.id": "orders.user_id"}
        }
    ],
    "select": ["users.*", {"fn": "sum", "field": "orders.amount", "as": "total_spent"}],
    "group_by": ["users.id"]
}`)
// â†’ SELECT users.*, SUM(orders.amount) as total_spent 
//   FROM users LEFT JOIN orders ON users.id = orders.user_id 
//   GROUP BY users.id


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å­æŸ¥è¯¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// WHERE IN (å­æŸ¥è¯¢)
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [
        {
            "field": "id",
            "op": "in",
            "subquery": {
                "table": "orders",
                "action": "find",
                "select": ["user_id"],
                "where": [{"field": "amount", "op": ">", "value": 1000}]
            }
        }
    ]
}`)
// â†’ SELECT * FROM users WHERE id IN (SELECT user_id FROM orders WHERE amount > 1000)

// EXISTS å­æŸ¥è¯¢
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [
        {
            "op": "exists",
            "subquery": {
                "table": "posts",
                "action": "find",
                "where": [{"field": "posts.user_id", "op": "=", "ref": "users.id"}]
            }
        }
    ]
}`)
// â†’ SELECT * FROM users WHERE EXISTS (SELECT 1 FROM posts WHERE posts.user_id = users.id)


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è‡ªç„¶è¯­è¨€å¤„ç†å¤æ‚æŸ¥è¯¢ï¼ˆç»ˆæç®€åŒ–ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// AI è‡ªåŠ¨è½¬æ¢ä¸ºä¸Šè¿° JQL
result := db.NL("æŸ¥æ‰¾æ‰€æœ‰æœ‰è®¢å•é‡‘é¢è¶…è¿‡1000å…ƒçš„ç”¨æˆ·ï¼ŒæŒ‰æ€»æ¶ˆè´¹é‡‘é¢æ’åº")
/*
è‡ªåŠ¨è½¬æ¢ä¸º:
{
    "table": "users",
    "action": "find",
    "join": [{"table": "orders", "type": "inner", "on": {"users.id": "orders.user_id"}}],
    "where": [{"field": "orders.amount", "op": ">", "value": 1000}],
    "select": ["users.*", {"fn": "sum", "field": "orders.amount", "as": "total"}],
    "group_by": ["users.id"],
    "order_by": [{"field": "total", "desc": true}]
}
*/

result := db.NL("ç»Ÿè®¡æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥æ•°é‡å’Œå¹³å‡å·¥èµ„")
/*
{
    "table": "employees",
    "action": "aggregate",
    "join": [{"table": "departments", "on": {"employees.dept_id": "departments.id"}}],
    "select": [
        "departments.name",
        {"fn": "count", "as": "employee_count"},
        {"fn": "avg", "field": "salary", "as": "avg_salary"}
    ],
    "group_by": ["departments.id", "departments.name"]
}
*/
```

### äº‹åŠ¡å¤„ç†ï¼ˆJQL é£æ ¼ï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JQL äº‹åŠ¡ - å¤šä¸ªæ“ä½œåŸå­æ‰§è¡Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// äº‹åŠ¡ï¼šåˆ›å»ºç”¨æˆ·å¹¶åˆ›å»ºè®¢å•
result := db.Execute(`{
    "action": "transaction",
    "operations": [
        {
            "table": "users",
            "action": "create",
            "data": {"name": "å¼ ä¸‰", "email": "zhangsan@example.com"},
            "as": "new_user"
        },
        {
            "table": "orders",
            "action": "create",
            "data": {
                "user_id": "$new_user.id",
                "amount": 100
            }
        }
    ]
}`)
/*
å“åº”ï¼š
{
    "success": true,
    "transaction_id": "tx_abc123",
    "results": [
        {"step": "new_user", "id": 1, "affected": 1},
        {"step": 2, "id": 1, "affected": 1}
    ]
}
*/

// å¸¦æ¡ä»¶çš„äº‹åŠ¡ï¼ˆæœ‰æ¡ä»¶å›æ»šï¼‰
result := db.Execute(`{
    "action": "transaction",
    "operations": [
        {
            "table": "accounts",
            "action": "update",
            "where": [{"field": "id", "op": "=", "value": 1}],
            "data": {"balance": {"$decr": 100}},
            "as": "debit"
        },
        {
            "action": "check",
            "condition": "$debit.new_balance >= 0",
            "on_fail": "rollback",
            "message": "ä½™é¢ä¸è¶³"
        },
        {
            "table": "accounts",
            "action": "update",
            "where": [{"field": "id", "op": "=", "value": 2}],
            "data": {"balance": {"$incr": 100}}
        }
    ]
}`)

// è‡ªç„¶è¯­è¨€äº‹åŠ¡
result := db.NL("ä»è´¦æˆ·1è½¬è´¦100å…ƒåˆ°è´¦æˆ·2ï¼Œå¦‚æœä½™é¢ä¸è¶³åˆ™å–æ¶ˆ")
```

### Context æ”¯æŒï¼ˆè¶…æ—¶å’Œå–æ¶ˆï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Context - Go æ ‡å‡†å®è·µï¼Œè¶…æ—¶æ§åˆ¶å’Œå–æ¶ˆæ“ä½œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ–¹å¼ä¸€ï¼šåœ¨ JQL ä¸­æŒ‡å®šè¶…æ—¶
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "timeout": "5s"
}`)

// æ–¹å¼äºŒï¼šä½¿ç”¨ Go Context
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()

result := db.ExecuteContext(ctx, `{
    "table": "users",
    "action": "find",
    "where": [{"field": "status", "op": "=", "value": "active"}]
}`)

// æ–¹å¼ä¸‰ï¼šå…¨å±€é»˜è®¤è¶…æ—¶
db.Configure(goorm.Config{
    DefaultTimeout: 10 * time.Second,
    QueryTimeout:   5 * time.Second,   // æŸ¥è¯¢è¶…æ—¶
    WriteTimeout:   30 * time.Second,  // å†™æ“ä½œè¶…æ—¶
})

// è¶…æ—¶å“åº”
/*
{
    "success": false,
    "error": {
        "code": "TIMEOUT",
        "message": "æŸ¥è¯¢è¶…æ—¶ï¼ˆ5sï¼‰",
        "suggestion": "è€ƒè™‘æ·»åŠ ç´¢å¼•æˆ–ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶"
    }
}
*/

// å–æ¶ˆæ“ä½œ
ctx, cancel := context.WithCancel(context.Background())
go func() {
    time.Sleep(2 * time.Second)
    cancel()  // 2ç§’åå–æ¶ˆ
}()

result := db.ExecuteContext(ctx, `{...}`)
// â†’ {"success": false, "error": {"code": "CANCELLED", ...}}
```

### æŸ¥è¯¢è§£é‡Š/è°ƒè¯•

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æŸ¥è¯¢è§£é‡Š - æŸ¥çœ‹ JQL ç”Ÿæˆçš„ SQLï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// è§£é‡ŠæŸ¥è¯¢ä½†ä¸æ‰§è¡Œ
result := db.Execute(`{
    "action": "explain",
    "query": {
        "table": "users",
        "action": "find",
        "where": [
            {"field": "age", "op": ">", "value": 18},
            {"field": "status", "op": "=", "value": "active"}
        ],
        "order_by": [{"field": "created_at", "desc": true}],
        "limit": 10
    }
}`)

/*
å“åº”ï¼š
{
    "success": true,
    "explain": {
        "sql": "SELECT * FROM users WHERE age > $1 AND status = $2 ORDER BY created_at DESC LIMIT 10",
        "params": [18, "active"],
        "estimated_rows": 1500,
        "estimated_cost": 125.5,
        "index_used": ["idx_users_status"],
        "index_suggested": ["idx_users_age_status"],
        "warnings": []
    }
}
*/

// éªŒè¯ JQL è¯­æ³•ä½†ä¸æ‰§è¡Œ
result := db.Execute(`{
    "action": "validate",
    "query": {
        "table": "users",
        "action": "find",
        "where": [{"field": "agee", "op": ">", "value": 18}]
    }
}`)

/*
å“åº”ï¼ˆæœ‰é”™è¯¯ï¼‰ï¼š
{
    "success": false,
    "error": {
        "code": "INVALID_FIELD",
        "message": "å­—æ®µ 'agee' ä¸å­˜åœ¨äºè¡¨ 'users'",
        "suggestion": "ä½ æ˜¯å¦æƒ³è¾“å…¥ 'age'?",
        "valid_fields": ["id", "name", "email", "age", "status", "created_at"]
    }
}
*/

// è°ƒè¯•æ¨¡å¼ï¼šæ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å› SQL
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "age", "op": ">", "value": 18}],
    "debug": true
}`)

/*
å“åº”ï¼ˆåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼‰ï¼š
{
    "success": true,
    "data": [...],
    "meta": {
        "sql": "SELECT * FROM users WHERE age > $1",
        "params": [18],
        "duration_ms": 5,
        "rows_scanned": 1000,
        "rows_returned": 150
    }
}
*/
```

---

## å…³è”å…³ç³»è®¾è®¡

### å…³è”ç±»å‹

```go
type User struct {
    goorm.Model
    Name     string
    
    // ä¸€å¯¹ä¸€ï¼šç”¨æˆ·æœ‰ä¸€ä¸ªèµ„æ–™
    Profile  *Profile  `rel:"has_one"`
    
    // ä¸€å¯¹å¤šï¼šç”¨æˆ·æœ‰å¤šç¯‡æ–‡ç« 
    Posts    []Post    `rel:"has_many"`
    
    // å¤šå¯¹å¤šï¼šç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²
    Roles    []Role    `rel:"many_to_many" join:"user_roles"`
    
    // åå‘å…³è”ï¼šç”¨æˆ·å±äºæŸä¸ªéƒ¨é—¨
    DeptID   uint
    Dept     *Dept     `rel:"belongs_to"`
}

type Post struct {
    goorm.Model
    Title    string
    UserID   uint
    
    // åå‘å…³è”
    Author   *User     `rel:"belongs_to" fk:"user_id"`
    
    // ä¸€å¯¹å¤š
    Comments []Comment `rel:"has_many"`
    
    // å¤šå¯¹å¤š
    Tags     []Tag     `rel:"many_to_many" join:"post_tags"`
}
```

### å…³è”æŸ¥è¯¢ï¼ˆJQL é£æ ¼ï¼‰

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é¢„åŠ è½½å…³è”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åŠ è½½å•ä¸ªå…³è”
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "with": ["profile"]
}`)

// åŠ è½½å¤šä¸ªå…³è”
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "with": ["profile", "posts", "roles"]
}`)

// åµŒå¥—åŠ è½½ï¼ˆè‡ªåŠ¨é€’å½’åŠ è½½ï¼‰
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "with": ["posts.comments", "posts.tags"]
}`)
// â†’ è¿”å›ç”¨æˆ·ï¼Œå¸¦ posts æ•°ç»„ï¼Œæ¯ä¸ª post å¯¹è±¡å« comments å’Œ tags

// å¸¦æ¡ä»¶çš„å…³è”åŠ è½½
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "where": [{"field": "id", "op": "=", "value": 1}],
    "with": [
        {
            "relation": "posts",
            "where": [{"field": "status", "op": "=", "value": "published"}],
            "order_by": [{"field": "created_at", "desc": true}],
            "limit": 5
        }
    ]
}`)


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å…³è”æ“ä½œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åˆ›å»ºå…³è”è®°å½•
result := db.Execute(`{
    "table": "posts",
    "action": "create",
    "data": {
        "title": "æ–°æ–‡ç« ",
        "user_id": 1
    }
}`)

// æ·»åŠ å¤šå¯¹å¤šå…³è”
result := db.Execute(`{
    "table": "user_roles",
    "action": "attach",
    "parent": {"table": "users", "id": 1},
    "related": {"table": "roles", "ids": [1, 2, 3]}
}`)

// ç§»é™¤å¤šå¯¹å¤šå…³è”
result := db.Execute(`{
    "table": "user_roles",
    "action": "detach",
    "parent": {"table": "users", "id": 1},
    "related": {"table": "roles", "ids": [1]}
}`)

// åŒæ­¥å¤šå¯¹å¤šå…³è”ï¼ˆæ›¿æ¢ç°æœ‰çš„ï¼‰
result := db.Execute(`{
    "table": "user_roles",
    "action": "sync",
    "parent": {"table": "users", "id": 1},
    "related": {"table": "roles", "ids": [2, 3, 4]}
}`)


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å…³è”æŸ¥è¯¢ï¼ˆHas / WhereHasï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æŸ¥è¯¢æœ‰æ–‡ç« çš„ç”¨æˆ·
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "has": "posts"
}`)
// â†’ åªè¿”å›æœ‰ posts çš„ç”¨æˆ·

// æŸ¥è¯¢æœ‰æŒ‡å®šæ¡ä»¶æ–‡ç« çš„ç”¨æˆ·
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "has": {
        "relation": "posts",
        "where": [{"field": "status", "op": "=", "value": "published"}]
    }
}`)

// æŸ¥è¯¢è‡³å°‘æœ‰ 5 ç¯‡æ–‡ç« çš„ç”¨æˆ·
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "has": {
        "relation": "posts",
        "count": {"op": ">=", "value": 5}
    }
}`)

// æŸ¥è¯¢æ²¡æœ‰æ–‡ç« çš„ç”¨æˆ·
result := db.Execute(`{
    "table": "users",
    "action": "find",
    "has": {"relation": "posts", "exists": false}
}`)


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è‡ªç„¶è¯­è¨€å¤„ç†å…³è”æŸ¥è¯¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

result := db.NL("æŸ¥æ‰¾æ‰€æœ‰å‘è¡¨è¿‡æ–‡ç« çš„ç”¨æˆ·ï¼Œå¹¶åŠ è½½ä»–ä»¬çš„æœ€è¿‘5ç¯‡æ–‡ç« ")
/*
{
    "table": "users",
    "action": "find",
    "has": "posts",
    "with": [
        {
            "relation": "posts",
            "order_by": [{"field": "created_at", "desc": true}],
            "limit": 5
        }
    ]
}
*/

result := db.NL("ç»™ç”¨æˆ·1æ·»åŠ ç®¡ç†å‘˜å’Œç¼–è¾‘è§’è‰²")
/*
{
    "table": "user_roles",
    "action": "attach",
    "parent": {"table": "users", "id": 1},
    "related": {"table": "roles", "names": ["admin", "editor"]}
}
*/
```

---

## å¤šæ•°æ®åº“æ”¯æŒ

### æ–¹è¨€æ¥å£

```go
type Dialect interface {
    // åŸºæœ¬ä¿¡æ¯
    Name() string  // "postgres" / "mysql"
    
    // ç±»å‹æ˜ å°„
    GoToSQL(goType reflect.Type, tags FieldTags) string
    SQLToGo(sqlType string) reflect.Type
    
    // DDL ç”Ÿæˆ
    CreateTableSQL(table *Table) string
    AddColumnSQL(table, column string, def *Column) string
    ModifyColumnSQL(table, column string, def *Column) string
    DropColumnSQL(table, column string) string
    DropTableSQL(table string) string
    
    // è¯»å–å½“å‰ Schema
    GetTables(db *sql.DB) ([]string, error)
    GetColumns(db *sql.DB, table string) ([]Column, error)
    GetIndexes(db *sql.DB, table string) ([]Index, error)
    
    // æŸ¥è¯¢æ–¹è¨€
    Quote(identifier string) string           // æ ‡è¯†ç¬¦å¼•ç”¨
    Placeholder(n int) string                 // å‚æ•°å ä½ç¬¦ ($1, ?)
    LimitOffset(limit, offset int) string     // åˆ†é¡µè¯­æ³•
}
```

### ç±»å‹æ˜ å°„

```
Go ç±»å‹          PostgreSQL              MySQL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string          VARCHAR(255)            VARCHAR(255)
string (text)   TEXT                    TEXT
int             INTEGER                 INT
int64           BIGINT                  BIGINT
uint            INTEGER                 INT UNSIGNED
float32         REAL                    FLOAT
float64         DOUBLE PRECISION        DOUBLE
bool            BOOLEAN                 TINYINT(1)
time.Time       TIMESTAMP WITH TZ       DATETIME
[]byte          BYTEA                   BLOB
uuid.UUID       UUID                    CHAR(36)
```

### è¿æ¥å­—ç¬¦ä¸²

```go
// è‡ªåŠ¨è¯†åˆ«æ•°æ®åº“ç±»å‹
db := goorm.Connect("postgres://user:pass@localhost:5432/mydb")
db := goorm.Connect("mysql://user:pass@localhost:3306/mydb")

// æ˜¾å¼æŒ‡å®š
db := goorm.Connect("host=localhost user=dev dbname=mydb", goorm.Postgres)
```

---

## AI å‹å¥½è®¾è®¡

> **"è®© AI åƒç†è§£äººç±»è¯­è¨€ä¸€æ ·ç†è§£ä½ çš„æ•°æ®åº“"**

### è®¾è®¡ç†å¿µ

GoORM ä»**åº•å±‚æ¶æ„**å°±åŸç”Ÿæ”¯æŒ AIï¼Œè€Œä¸æ˜¯äº‹åè¡¥ä¸ã€‚è¿™æ„å‘³ç€ï¼š

1. **Schema å³æ–‡æ¡£** - æ¨¡å‹è‡ªå¸¦å®Œæ•´çš„è¯­ä¹‰æè¿°ï¼ŒAI å¯ä»¥ç†è§£è¡¨ç»“æ„
2. **è‡ªç„¶è¯­è¨€ä¼˜å…ˆ** - æ”¯æŒç”¨è‡ªç„¶è¯­è¨€æè¿°æŸ¥è¯¢æ„å›¾
3. **å‘é‡åŸç”Ÿ** - å†…ç½® Embedding å’Œå‘é‡æœç´¢æ”¯æŒ
4. **MCP åè®®** - åŸç”Ÿæ”¯æŒ Model Context Protocolï¼Œå¯ä½œä¸º AI å·¥å…·

### æ ¸å¿ƒèƒ½åŠ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AI å‹å¥½å±‚ (AI-Friendly Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ è‡ªç„¶è¯­è¨€æŸ¥è¯¢â”‚  â”‚ Schema ç†è§£ â”‚  â”‚  å‘é‡æœç´¢   â”‚             â”‚
â”‚  â”‚ NL â†’ SQL   â”‚  â”‚ AI å¯è§£æ   â”‚  â”‚ Embedding   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  MCP å·¥å…·   â”‚  â”‚ ç»“æ„åŒ–è¾“å‡º  â”‚  â”‚  æ™ºèƒ½å»ºè®®   â”‚             â”‚
â”‚  â”‚ AI Agent   â”‚  â”‚ JSON/Schema â”‚  â”‚ ç´¢å¼•/ä¼˜åŒ–   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1. Schema è‡ªæè¿° (Self-Describing Schema)

æ¯ä¸ªæ¨¡å‹éƒ½å¯ä»¥æºå¸¦ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ï¼Œè®© AI å®Œå…¨ç†è§£ä½ çš„æ•°æ®ç»“æ„ï¼š

```go
type User struct {
    goorm.Model `desc:"ç³»ç»Ÿç”¨æˆ·è¡¨ï¼Œå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯"`
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åŸºç¡€å­—æ®µ - å¸¦è¯­ä¹‰æè¿°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Name  string `json:"name" 
                  desc:"ç”¨æˆ·å§“åï¼Œæ”¯æŒä¸­è‹±æ–‡" 
                  example:"å¼ ä¸‰"
                  searchable:"true"`           // é€‚åˆæœç´¢
    
    Email string `json:"email" 
                  desc:"ç”¨æˆ·é‚®ç®±ï¼Œå”¯ä¸€æ ‡è¯†" 
                  format:"email"
                  unique:"true"`
    
    Age   int    `json:"age" 
                  desc:"å¹´é¾„" 
                  min:"0" max:"150"`
    
    Status string `json:"status" 
                   desc:"è´¦æˆ·çŠ¶æ€"
                   enum:"active,inactive,banned"  // æšä¸¾å€¼ï¼ŒAI åªèƒ½è®¾ç½®è¿™äº›
                   default:"active"`
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ•æ„Ÿå­—æ®µ - AI éœ€è¦ç‰¹æ®Šå¤„ç†
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Password string `json:"-"                     // JSON ä¸å¯¼å‡º
                     desc:"å¯†ç å“ˆå¸Œ"
                     sensitive:"true"             // æ•æ„Ÿæ•°æ®ï¼ŒAI ä¸åº”è¿”å›
                     writeonly:"true"`            // åªå†™ï¼ŒæŸ¥è¯¢æ—¶ä¸è¿”å›
    
    Phone string `json:"phone" 
                  desc:"æ‰‹æœºå·"
                  sensitive:"true"
                  mask:"partial"`                // è¿”å›æ—¶è„±æ•: 138****8888
    
    IDCard string `json:"id_card"
                   desc:"èº«ä»½è¯å·"
                   sensitive:"true"
                   mask:"hide"`                  // å®Œå…¨éšè—
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¸šåŠ¡å­—æ®µ - å¸¦çº¦æŸå’Œè®¡ç®—è§„åˆ™
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Balance float64 `json:"balance" 
                     desc:"è´¦æˆ·ä½™é¢"
                     computed:"true"             // è®¡ç®—å­—æ®µï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹
                     precision:"2"`              // ç²¾åº¦
    
    VIP bool `json:"vip" 
              desc:"æ˜¯å¦VIPç”¨æˆ·"
              semantic:"customer_tier"`          // ä¸šåŠ¡è¯­ä¹‰æ ‡ç­¾
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¤–é”®å…³ç³» - æ˜¾å¼å£°æ˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    DeptID uint `json:"dept_id"
                 desc:"æ‰€å±éƒ¨é—¨"
                 references:"departments.id"     // å¤–é”®ç›®æ ‡
                 on_delete:"set_null"`           // åˆ é™¤ç­–ç•¥
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åºŸå¼ƒå­—æ®µ - è¿ç§»æ—¶ä¼šå¤„ç†
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    OldPhone string `json:"old_phone"
                     deprecated:"true"           // åºŸå¼ƒå­—æ®µ
                     deprecated_since:"2024-01-01"
                     migrated_to:"phone"`        // æ•°æ®å·²è¿ç§»åˆ°å“ªä¸ªå­—æ®µ
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å…³è”å­—æ®µ - å¸¦æè¿°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Posts   []Post   `rel:"has_many" desc:"ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« "`
    Profile *Profile `rel:"has_one" desc:"ç”¨æˆ·è¯¦ç»†èµ„æ–™"`
}

// å¯¼å‡º Schema ç»™ AI ä½¿ç”¨
schema := db.Schema.Describe("User")
/*
è¾“å‡ºå®Œæ•´çš„ JSON Schemaï¼ˆåŒ…å« AI æç¤ºï¼‰ï¼š
{
  "table": "users",
  "description": "ç³»ç»Ÿç”¨æˆ·è¡¨ï¼Œå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯",
  "fields": [
    {
      "name": "name",
      "type": "string",
      "description": "ç”¨æˆ·å§“åï¼Œæ”¯æŒä¸­è‹±æ–‡",
      "example": "å¼ ä¸‰",
      "searchable": true,
      "constraints": {"required": true, "maxLength": 255}
    },
    {
      "name": "phone",
      "type": "string",
      "description": "æ‰‹æœºå·",
      "sensitive": true,
      "mask": "partial",
      "ai_hint": "æ­¤å­—æ®µä¸ºæ•æ„Ÿæ•°æ®ï¼Œè¿”å›æ—¶ä¼šè„±æ•æ˜¾ç¤º"
    },
    {
      "name": "status",
      "type": "string",
      "description": "è´¦æˆ·çŠ¶æ€",
      "enum": ["active", "inactive", "banned"],
      "default": "active",
      "ai_hint": "åªèƒ½è®¾ç½®ä¸ºæšä¸¾å€¼ä¹‹ä¸€"
    },
    {
      "name": "balance",
      "type": "float64",
      "description": "è´¦æˆ·ä½™é¢",
      "computed": true,
      "ai_hint": "è®¡ç®—å­—æ®µï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹"
    }
  ],
  "relations": [
    {
      "name": "Posts",
      "type": "has_many",
      "target": "posts",
      "description": "ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« "
    }
  ],
  "foreign_keys": [
    {
      "field": "dept_id",
      "references": "departments.id",
      "on_delete": "set_null"
    }
  ]
}
*/
```

**æ”¯æŒçš„å…ƒæ•°æ®æ ‡ç­¾å®Œæ•´åˆ—è¡¨ï¼š**

| æ ‡ç­¾ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `desc` | å­—æ®µæè¿° | `desc:"ç”¨æˆ·å§“å"` |
| `example` | ç¤ºä¾‹å€¼ | `example:"å¼ ä¸‰"` |
| `format` | æ ¼å¼éªŒè¯ | `format:"email"` / `format:"url"` |
| `enum` | æšä¸¾å€¼ | `enum:"active,inactive,banned"` |
| `min` / `max` | æ•°å€¼èŒƒå›´ | `min:"0" max:"150"` |
| `minLength` / `maxLength` | é•¿åº¦èŒƒå›´ | `minLength:"6"` |
| `default` | é»˜è®¤å€¼ | `default:"active"` |
| `unique` | å”¯ä¸€çº¦æŸ | `unique:"true"` |
| `required` | å¿…å¡« | `required:"true"` |
| `sensitive` | æ•æ„Ÿæ•°æ® | `sensitive:"true"` |
| `mask` | è„±æ•æ–¹å¼ | `mask:"partial"` / `mask:"hide"` |
| `writeonly` | åªå†™å­—æ®µ | `writeonly:"true"` |
| `searchable` | å¯æœç´¢ | `searchable:"true"` |
| `computed` | è®¡ç®—å­—æ®µ | `computed:"true"` |
| `deprecated` | åºŸå¼ƒå­—æ®µ | `deprecated:"true"` |
| `references` | å¤–é”®å¼•ç”¨ | `references:"users.id"` |
| `on_delete` | åˆ é™¤ç­–ç•¥ | `on_delete:"cascade"` |
| `semantic` | ä¸šåŠ¡è¯­ä¹‰ | `semantic:"customer_tier"` |

---

### 2. è‡ªç„¶è¯­è¨€æŸ¥è¯¢ (Natural Language Query)

è®© AI èƒ½å¤Ÿå°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºæ•°æ®åº“æŸ¥è¯¢ï¼š

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ–¹å¼ä¸€ï¼šç›´æ¥è‡ªç„¶è¯­è¨€æŸ¥è¯¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// AI å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ¥å£
result := db.NL("æŸ¥æ‰¾æ‰€æœ‰å¹´é¾„å¤§äº18å²çš„VIPç”¨æˆ·ï¼ŒæŒ‰æ³¨å†Œæ—¶é—´å€’åº")
// å†…éƒ¨è½¬æ¢ä¸º: db.User.Where("age > ?", 18).Where("vip = ?", true).OrderBy("created_at DESC").All()

result := db.NL("ç»Ÿè®¡æ¯ä¸ªéƒ¨é—¨çš„äººæ•°")
// å†…éƒ¨è½¬æ¢ä¸º: db.User.Select("dept_id", "COUNT(*) as count").GroupBy("dept_id").All()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ–¹å¼äºŒï¼šè·å– SQL è€Œä¸æ‰§è¡Œï¼ˆè®© AI ç¡®è®¤ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

query := db.NLToQuery("åˆ é™¤æ‰€æœ‰3å¹´å‰æ³¨å†Œä¸”ä»æœªç™»å½•çš„ç”¨æˆ·")
fmt.Println(query.SQL())     // DELETE FROM users WHERE created_at < '2023-02-03' AND login_count = 0
fmt.Println(query.Explain()) // è§£é‡Šè¿™ä¸ªæŸ¥è¯¢ä¼šå½±å“å¤šå°‘æ¡è®°å½•

// AI ç¡®è®¤åå†æ‰§è¡Œ
if confirmed {
    query.Execute()
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ–¹å¼ä¸‰ï¼šæŸ¥è¯¢æ„å›¾è§£æ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

intent := db.ParseIntent("æ‰¾å‡ºæœ€è¿‘ä¸€å‘¨è´­ä¹°é‡‘é¢è¶…è¿‡1000çš„ç”¨æˆ·")
/*
{
  "action": "select",
  "table": "users",
  "conditions": [
    {"field": "orders.created_at", "op": ">=", "value": "7 days ago"},
    {"field": "orders.amount", "op": ">", "value": 1000}
  ],
  "joins": ["orders"],
  "confidence": 0.95
}
*/
```

---

### 3. å‘é‡æœç´¢åŸç”Ÿæ”¯æŒ (Vector Search)

å†…ç½®å¯¹ pgvector / MySQL å‘é‡æ‰©å±•çš„æ”¯æŒï¼š

```go
type Article struct {
    goorm.Model
    Title     string    `json:"title"`
    Content   string    `json:"content"`
    
    // å‘é‡å­—æ®µ - å­˜å‚¨æ–‡ç« çš„ embedding
    Embedding []float32 `json:"embedding" vector:"1536" desc:"OpenAI text-embedding-3 ç”Ÿæˆçš„å‘é‡"`
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è¯­ä¹‰æœç´¢
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ–¹å¼ä¸€ï¼šä¼ å…¥æŸ¥è¯¢æ–‡æœ¬ï¼Œè‡ªåŠ¨ç”Ÿæˆ embedding å¹¶æœç´¢
articles := db.Article.SemanticSearch("å¦‚ä½•ä½¿ç”¨ Go è¯­è¨€è¿æ¥æ•°æ®åº“", 10)

// æ–¹å¼äºŒï¼šä¼ å…¥ embedding å‘é‡
embedding := getEmbedding("å¦‚ä½•ä½¿ç”¨ Go è¯­è¨€è¿æ¥æ•°æ®åº“")  // ä» OpenAI ç­‰è·å–
articles := db.Article.VectorSearch(embedding, 10)

// æ–¹å¼ä¸‰ï¼šæ··åˆæœç´¢ï¼ˆå‘é‡ + å…³é”®è¯ï¼‰
articles := db.Article.
    Where("category = ?", "æŠ€æœ¯").
    SemanticSearch("æ•°æ®åº“ä¼˜åŒ–", 10)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è‡ªåŠ¨ç”Ÿæˆ Embedding
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// é…ç½® embedding æä¾›è€…
db.ConfigureEmbedding(goorm.EmbeddingConfig{
    Provider: "openai",           // æˆ– "ollama", "local"
    Model:    "text-embedding-3-small",
    APIKey:   os.Getenv("OPENAI_API_KEY"),
})

// åˆ›å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆ embedding
article := db.Article.Create(&Article{
    Title:   "Go è¯­è¨€å…¥é—¨",
    Content: "è¿™æ˜¯ä¸€ç¯‡å…³äº Go è¯­è¨€çš„å…¥é—¨æ•™ç¨‹...",
    // Embedding ä¼šè‡ªåŠ¨æ ¹æ® Title + Content ç”Ÿæˆ
})

// æˆ–è€…æ‰‹åŠ¨è§¦å‘
db.Article.GenerateEmbeddings("id IN ?", []int{1, 2, 3})
```

---

### 4. MCP å·¥å…·åè®® (Model Context Protocol)

GoORM å¯ä»¥ç›´æ¥ä½œä¸º MCP å·¥å…·ï¼Œè®© AI Agent æ“ä½œæ•°æ®åº“ï¼š

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¯åŠ¨ MCP æœåŠ¡å™¨
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

mcp := db.MCPServer(goorm.MCPConfig{
    Name:        "database-tools",
    Description: "æ•°æ®åº“æ“ä½œå·¥å…·é›†",
    
    // å®‰å…¨é…ç½®
    ReadOnly:    false,           // æ˜¯å¦åªè¯»
    AllowTables: []string{"*"},   // å…è®¸æ“ä½œçš„è¡¨
    DenyTables:  []string{"_*"},  // ç¦æ­¢æ“ä½œçš„è¡¨ï¼ˆå¦‚å¤‡ä»½è¡¨ï¼‰
    MaxRows:     1000,            // å•æ¬¡æŸ¥è¯¢æœ€å¤§è¿”å›è¡Œæ•°
    MaxAffected: 100,             // UPDATE/DELETE æœ€å¤šå½±å“è¡Œæ•°
    
    // ç¡®è®¤æœºåˆ¶
    RequireConfirmFor: []string{"update", "delete"},  // è¿™äº›æ“ä½œéœ€è¦ç¡®è®¤
})

mcp.Start()  // å¯åŠ¨ MCP æœåŠ¡

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å®Œæ•´çš„ MCP å·¥å…·åˆ—è¡¨ï¼ˆ14ä¸ªï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
AI Agent å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æŸ¥è¯¢ç±»å·¥å…·
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. describe_schema
   - è·å–æ•°æ®åº“ Schema æè¿°ï¼ˆåŒ…å« AI æç¤ºï¼‰
   - è¾“å…¥: {tables?: string[]}
   - è¾“å‡º: {schema: SchemaDescription}

2. query_data
   - æ‰§è¡Œè‡ªç„¶è¯­è¨€æŸ¥è¯¢æˆ–ç»“æ„åŒ–æŸ¥è¯¢
   - è¾“å…¥: {query: string, preview?: boolean} æˆ– {conditions: Condition[]}
   - è¾“å‡º: {sql: string, data: any[], rowCount: number, meta: QueryMeta}

3. get_sample_data â­ æ–°å¢
   - è·å–è¡¨çš„ç¤ºä¾‹æ•°æ®ï¼ˆå¸®åŠ© AI ç†è§£æ•°æ®æ ¼å¼ï¼‰
   - è¾“å…¥: {table: string, limit?: number}
   - è¾“å‡º: {columns: Column[], sample_rows: any[], stats: TableStats}

4. get_table_stats â­ æ–°å¢
   - è·å–è¡¨ç»Ÿè®¡ä¿¡æ¯
   - è¾“å…¥: {table: string}
   - è¾“å‡º: {row_count: number, size_bytes: number, index_count: number, 
            last_updated: string, column_stats: ColumnStats[]}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å†™å…¥ç±»å·¥å…·
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5. insert_data
   - æ’å…¥æ•°æ®
   - è¾“å…¥: {table: string, data: object | object[]}
   - è¾“å‡º: {inserted: number, ids: any[], operation_id: string}

6. update_data
   - æ›´æ–°æ•°æ®ï¼ˆå¯èƒ½éœ€è¦ç¡®è®¤ï¼‰
   - è¾“å…¥: {table: string, where: Condition[], data: object, preview?: boolean}
   - è¾“å‡º: {status: "pending_confirm" | "success", affected_rows: number, 
            confirm_token?: string, preview?: object[]}

7. delete_data
   - åˆ é™¤æ•°æ®ï¼ˆå¯èƒ½éœ€è¦ç¡®è®¤ï¼‰
   - è¾“å…¥: {table: string, where: Condition[], preview?: boolean}
   - è¾“å‡º: {status: "pending_confirm" | "success", affected_rows: number,
            confirm_token?: string, preview?: object[]}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ç¡®è®¤ä¸å›æ»š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

8. confirm_operation â­ æ–°å¢
   - ç¡®è®¤å¾…æ‰§è¡Œçš„ç ´åæ€§æ“ä½œ
   - è¾“å…¥: {confirm_token: string}
   - è¾“å‡º: {success: boolean, affected_rows: number, operation_id: string}

9. undo_operation â­ æ–°å¢
   - æ’¤é”€æœ€è¿‘çš„æ“ä½œï¼ˆå¦‚æœæœ‰å¤‡ä»½ï¼‰
   - è¾“å…¥: {operation_id: string}
   - è¾“å‡º: {success: boolean, restored_rows: number}

10. list_backups â­ æ–°å¢
    - åˆ—å‡ºå¯æ¢å¤çš„å¤‡ä»½
    - è¾“å…¥: {table?: string, since?: string}
    - è¾“å‡º: {backups: Backup[]}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
åˆ†æä¸éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

11. validate_query â­ æ–°å¢
    - éªŒè¯ SQL è¯­æ³•ä½†ä¸æ‰§è¡Œ
    - è¾“å…¥: {query: string} æˆ– {nl_query: string}
    - è¾“å‡º: {valid: boolean, errors?: string[], parsed_sql?: string,
             affected_tables: string[], operation_type: string}

12. explain_query â­ æ–°å¢
    - è·å–æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’å’Œä¼˜åŒ–å»ºè®®
    - è¾“å…¥: {sql: string}
    - è¾“å‡º: {plan: string, estimated_cost: number, estimated_rows: number,
             suggestions: Suggestion[], indexes_used: string[]}

13. analyze_query
    - åˆ†ææŸ¥è¯¢æ€§èƒ½
    - è¾“å…¥: {sql: string}
    - è¾“å‡º: {plan: string, suggestions: string[]}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
è¯­ä¹‰æœç´¢
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

14. semantic_search
    - è¯­ä¹‰æœç´¢ï¼ˆå‘é‡æœç´¢ï¼‰
    - è¾“å…¥: {table: string, query: string, limit?: number, 
             filters?: Condition[], include_score?: boolean}
    - è¾“å‡º: {results: any[], scores?: number[], explain?: SearchExplain[]}
*/
```

MCP é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š

```json
{
  "mcpServers": {
    "goorm-db": {
      "command": "goorm",
      "args": ["mcp", "--config", "./goorm.yaml"],
      "env": {
        "DATABASE_URL": "postgres://..."
      }
    }
  }
}
```

---

### 5. ç»“æ„åŒ–è¾“å‡º (Structured Output)

æ‰€æœ‰è¾“å‡ºéƒ½æ˜¯ AI å‹å¥½çš„ç»“æ„åŒ–æ ¼å¼ï¼š

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æŸ¥è¯¢ç»“æœå…ƒæ•°æ®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

result := db.User.Where("age > ?", 18).AllWithMeta()
/*
{
  "data": [...],
  "meta": {
    "table": "users",
    "query": "SELECT * FROM users WHERE age > $1",
    "params": [18],
    "rowCount": 42,
    "executionTimeMs": 12,
    "columns": [
      {"name": "id", "type": "integer", "description": "ä¸»é”®"},
      {"name": "name", "type": "string", "description": "ç”¨æˆ·å§“å"},
      ...
    ]
  }
}
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é”™è¯¯ä¿¡æ¯ç»“æ„åŒ–
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// é”™è¯¯ä¹Ÿæ˜¯ç»“æ„åŒ–çš„ï¼Œæ–¹ä¾¿ AI ç†è§£å’Œå¤„ç†
err := db.User.Create(&User{Email: "invalid"})
/*
{
  "code": "VALIDATION_ERROR",
  "message": "å­—æ®µéªŒè¯å¤±è´¥",
  "details": [
    {
      "field": "email",
      "value": "invalid",
      "constraint": "format:email",
      "message": "ä¸æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼"
    }
  ],
  "suggestion": "è¯·æä¾›æ ¼å¼æ­£ç¡®çš„é‚®ç®±åœ°å€ï¼Œä¾‹å¦‚ï¼šuser@example.com"
}
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è¿ç§»ç»“æœç»“æ„åŒ–
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

diff := db.SyncPreview()
/*
{
  "changes": [
    {
      "type": "add_column",
      "table": "users",
      "column": "phone",
      "definition": "VARCHAR(20)",
      "reason": "æ¨¡å‹æ–°å¢ Phone å­—æ®µ"
    },
    {
      "type": "drop_column",
      "table": "users", 
      "column": "fax",
      "backup": "_backup_users_fax_20260203",
      "reason": "æ¨¡å‹ä¸­å·²åˆ é™¤ Fax å­—æ®µ"
    }
  ],
  "summary": {
    "tablesAffected": 1,
    "columnsAdded": 1,
    "columnsDropped": 1,
    "dataBackedUp": true
  },
  "sql": ["ALTER TABLE users ADD COLUMN phone VARCHAR(20)", ...]
}
*/
```

---

### 6. æ™ºèƒ½å»ºè®® (Intelligent Suggestions)

AI å¯ä»¥åŸºäºæŸ¥è¯¢æ¨¡å¼å’Œæ•°æ®åˆ†å¸ƒç»™å‡ºä¼˜åŒ–å»ºè®®ï¼š

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ç´¢å¼•å»ºè®®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

suggestions := db.AnalyzeIndexes()
/*
[
  {
    "type": "missing_index",
    "table": "orders",
    "columns": ["user_id", "created_at"],
    "reason": "æ£€æµ‹åˆ°é¢‘ç¹çš„ WHERE user_id = ? ORDER BY created_at æŸ¥è¯¢",
    "impact": "é¢„è®¡æŸ¥è¯¢é€Ÿåº¦æå‡ 10x",
    "sql": "CREATE INDEX idx_orders_user_created ON orders(user_id, created_at)"
  },
  {
    "type": "unused_index",
    "table": "users",
    "index": "idx_users_old_field",
    "reason": "è¿‡å»30å¤©å†…è¯¥ç´¢å¼•æœªè¢«ä½¿ç”¨",
    "suggestion": "è€ƒè™‘åˆ é™¤ä»¥å‡å°‘å­˜å‚¨å’Œå†™å…¥å¼€é”€"
  }
]
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æŸ¥è¯¢ä¼˜åŒ–å»ºè®®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

analysis := db.AnalyzeQuery("SELECT * FROM orders WHERE YEAR(created_at) = 2024")
/*
{
  "problems": [
    {
      "type": "function_on_column",
      "column": "created_at",
      "issue": "å¯¹åˆ—ä½¿ç”¨å‡½æ•°ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ",
      "suggestion": "æ”¹ç”¨ created_at >= '2024-01-01' AND created_at < '2025-01-01'"
    }
  ],
  "optimizedSQL": "SELECT * FROM orders WHERE created_at >= '2024-01-01' AND created_at < '2025-01-01'",
  "performanceGain": "é¢„è®¡ 20x æå‡"
}
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Schema è®¾è®¡å»ºè®®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

design := db.AnalyzeDesign()
/*
[
  {
    "type": "missing_foreign_key",
    "table": "orders",
    "column": "user_id",
    "suggestion": "æ·»åŠ å¤–é”®çº¦æŸåˆ° users è¡¨ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§"
  },
  {
    "type": "large_varchar",
    "table": "logs",
    "column": "message",
    "current": "VARCHAR(10000)",
    "suggestion": "è€ƒè™‘ä½¿ç”¨ TEXT ç±»å‹ï¼Œæˆ–å­˜å‚¨åˆ°å¯¹è±¡å­˜å‚¨"
  },
  {
    "type": "denormalization_opportunity",
    "tables": ["orders", "order_items"],
    "suggestion": "é«˜é¢‘æŸ¥è¯¢çš„è®¢å•æ€»é‡‘é¢å¯è€ƒè™‘å†—ä½™å­˜å‚¨"
  }
]
*/
```

---

### 7. AI å¯¹è¯ä¸Šä¸‹æ–‡ (Conversation Context)

ä¿æŒå¯¹è¯ä¸Šä¸‹æ–‡ï¼Œè®© AI è¿›è¡Œå¤šè½®æ•°æ®åº“æ“ä½œï¼š

```go
// åˆ›å»ºå¯¹è¯ä¸Šä¸‹æ–‡
ctx := db.NewAIContext()

// ç¬¬ä¸€è½®ï¼šè‡ªç„¶è¯­è¨€æŸ¥è¯¢
ctx.Execute("æ‰¾å‡ºä¸Šä¸ªæœˆé”€å”®é¢æœ€é«˜çš„10ä¸ªäº§å“")
// â†’ è¿”å›äº§å“åˆ—è¡¨

// ç¬¬äºŒè½®ï¼šåŸºäºä¸Šä¸€è½®ç»“æœç»§ç»­
ctx.Execute("è¿™äº›äº§å“çš„åº“å­˜æƒ…å†µæ€ä¹ˆæ ·ï¼Ÿ")
// AI ç†è§£"è¿™äº›äº§å“"æŒ‡çš„æ˜¯ä¸Šä¸€è½®æŸ¥è¯¢çš„ç»“æœ
// â†’ è¿”å›å¯¹åº”äº§å“çš„åº“å­˜ä¿¡æ¯

// ç¬¬ä¸‰è½®ï¼šæ‰§è¡Œæ“ä½œ
ctx.Execute("æŠŠåº“å­˜ä½äº100çš„äº§å“æ ‡è®°ä¸ºéœ€è¦è¡¥è´§")
// â†’ æ›´æ–°æ•°æ®å¹¶è¿”å›å½±å“çš„è¡Œæ•°

// æŸ¥çœ‹å¯¹è¯å†å²
ctx.History()
/*
[
  {
    "turn": 1,
    "input": "æ‰¾å‡ºä¸Šä¸ªæœˆé”€å”®é¢æœ€é«˜çš„10ä¸ªäº§å“",
    "sql": "SELECT p.* FROM products p JOIN order_items oi ON p.id = oi.product_id WHERE oi.created_at >= '2026-01-01' GROUP BY p.id ORDER BY SUM(oi.amount) DESC LIMIT 10",
    "resultCount": 10,
    "resultIds": [42, 17, 89, ...]
  },
  ...
]
*/
```

---

### 8. å¯è§‚æµ‹æ€§ (Observability)

ä¸°å¯Œçš„å…ƒæ•°æ®æ”¯æŒ AI åˆ†æå’Œç›‘æ§ï¼š

```go
// æŸ¥è¯¢è¿½è¸ª
db.EnableTracing()

result := db.User.Where("age > ?", 18).All()

trace := db.LastTrace()
/*
{
  "traceId": "abc123",
  "operation": "select",
  "table": "users",
  "sql": "SELECT * FROM users WHERE age > $1",
  "params": [18],
  "timing": {
    "parseMs": 0.5,
    "planMs": 1.2,
    "executeMs": 8.3,
    "totalMs": 10.0
  },
  "plan": {
    "type": "Index Scan",
    "index": "idx_users_age",
    "rows": 42
  },
  "caller": {
    "file": "main.go",
    "line": 25,
    "function": "main.handleUserList"
  }
}
*/

// å¯¼å‡ºåˆ° AI åˆ†æ
traces := db.ExportTraces(last24Hours)
// å¯ä»¥å‘é€ç»™ AI åˆ†ææ€§èƒ½ç“¶é¢ˆ
```

---

### AI é›†æˆé…ç½®

```go
db := goorm.Connect("postgres://...", goorm.WithAI(goorm.AIConfig{
    // è‡ªç„¶è¯­è¨€å¤„ç†
    NLProvider:  "openai",        // æˆ– "anthropic", "local"
    NLModel:     "gpt-4",
    NLAPIKey:    os.Getenv("OPENAI_API_KEY"),
    
    // Embedding
    EmbeddingProvider: "openai",
    EmbeddingModel:    "text-embedding-3-small",
    
    // MCP
    MCPEnabled:  true,
    MCPPort:     3000,
    
    // å®‰å…¨
    AIConfirmDestructive: true,   // ç ´åæ€§æ“ä½œå‰ AI éœ€è¦ç¡®è®¤
    MaxNLComplexity:      3,      // è‡ªç„¶è¯­è¨€æŸ¥è¯¢çš„æœ€å¤§å¤æ‚åº¦
}))
```

---

## å®‰å…¨è®¾è®¡

> **AI æ“ä½œæ•°æ®åº“çš„å®‰å…¨æ˜¯é‡ä¸­ä¹‹é‡** ğŸ”’

### 1. è‡ªç„¶è¯­è¨€æŸ¥è¯¢å®‰å…¨é˜²æŠ¤

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å®‰å…¨é…ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.Configure(goorm.Config{
    NLSecurity: goorm.NLSecurityConfig{
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // æ“ä½œé™åˆ¶
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        AllowedOperations: []string{"select", "count", "insert"},  // ç™½åå•
        // æˆ–è€…ä½¿ç”¨é»‘åå•
        // DenyOperations: []string{"delete", "drop", "truncate"},
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // è¡¨çº§é™åˆ¶
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        AllowedTables: []string{"*"},               // å…è®¸æ“ä½œçš„è¡¨
        DenyTables:    []string{"sys_*", "_backup_*", "audit_*"},  // ç¦æ­¢æ“ä½œçš„è¡¨
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // è¡Œæ•°é™åˆ¶
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        MaxRowsReturned: 1000,    // å•æ¬¡æŸ¥è¯¢æœ€å¤šè¿”å›è¡Œæ•°
        MaxRowsAffected: 100,     // UPDATE/DELETE æœ€å¤šå½±å“è¡Œæ•°
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ç¡®è®¤æœºåˆ¶
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        RequireConfirmFor:   []string{"update", "delete"},  // éœ€è¦ç¡®è®¤çš„æ“ä½œ
        ConfirmTimeoutSecs:  300,                           // ç¡®è®¤è¶…æ—¶æ—¶é—´
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // å¤æ‚åº¦é™åˆ¶ï¼ˆé˜²æ­¢è¿‡äºå¤æ‚çš„æŸ¥è¯¢ï¼‰
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        MaxJoinTables:    3,      // æœ€å¤š JOIN å‡ å¼ è¡¨
        MaxConditions:    10,     // æœ€å¤šå‡ ä¸ª WHERE æ¡ä»¶
        MaxSubqueries:    2,      // æœ€å¤šå‡ ä¸ªå­æŸ¥è¯¢
    },
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ç¡®è®¤æœºåˆ¶ç¤ºä¾‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

result := db.NL("åˆ é™¤æ‰€æœ‰3å¹´å‰æ³¨å†Œä¸”ä»æœªç™»å½•çš„ç”¨æˆ·")
/*
è¿”å›ï¼ˆéœ€è¦ç¡®è®¤ï¼‰:
{
    "status": "pending_confirm",
    "operation": "delete",
    "table": "users",
    "sql": "DELETE FROM users WHERE created_at < '2023-02-03' AND login_count = 0",
    "affected_rows": 1234,
    "warning": "âš ï¸ æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ 1234 æ¡è®°å½•",
    "confirm_token": "cfm_abc123xyz",
    "expires_at": "2026-02-03T15:30:00Z"
}
*/

// AI ç¡®è®¤åæ‰§è¡Œ
db.NLConfirm("cfm_abc123xyz")
/*
è¿”å›:
{
    "status": "success",
    "affected_rows": 1234,
    "operation_id": "op_def456",
    "backup_table": "_backup_users_20260203_152200"
}
*/

// å¦‚æœéœ€è¦æ’¤é”€
db.Undo("op_def456")
```

### 2. æ•æ„Ÿæ•°æ®è‡ªåŠ¨è„±æ•

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è„±æ•é…ç½®ï¼ˆå…¨å±€ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.Configure(goorm.Config{
    Masking: goorm.MaskingConfig{
        Enabled: true,
        
        // å…¨å±€è§„åˆ™
        Rules: []goorm.MaskRule{
            // æŒ‰å­—æ®µååŒ¹é…
            {Pattern: "password", Action: goorm.MaskHide},
            {Pattern: "*_password", Action: goorm.MaskHide},
            {Pattern: "phone", Action: goorm.MaskPartial, Format: "{{3}}****{{4}}"},
            {Pattern: "email", Action: goorm.MaskPartial, Format: "{{2}}***@***"},
            {Pattern: "id_card", Action: goorm.MaskPartial, Format: "{{6}}********{{4}}"},
            {Pattern: "*_token", Action: goorm.MaskHide},
            
            // æŒ‰è¡¨.å­—æ®µåŒ¹é…
            {Pattern: "users.salary", Action: goorm.MaskRange},
            {Pattern: "orders.amount", Action: goorm.MaskNone},  // ä¸è„±æ•
        },
        
        // æ’é™¤çš„ç”¨æˆ·/è§’è‰²ï¼ˆä»–ä»¬å¯ä»¥çœ‹åˆ°åŸå§‹æ•°æ®ï¼‰
        ExcludeRoles: []string{"admin", "data_analyst"},
    },
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è„±æ•æ•ˆæœ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
åŸå§‹æ•°æ®:
{
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "13812345678",
    "email": "zhangsan@example.com",
    "id_card": "110101199001011234",
    "password": "hashed_password_here"
}

AI çœ‹åˆ°çš„æ•°æ®:
{
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "138****5678",
    "email": "zh***@***",
    "id_card": "110101********1234",
    "password": "[HIDDEN]"
}
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è„±æ•ç±»å‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const (
    MaskHide    MaskAction = "hide"      // å®Œå…¨éšè—: [HIDDEN]
    MaskPartial MaskAction = "partial"   // éƒ¨åˆ†æ˜¾ç¤º: 138****5678
    MaskHash    MaskAction = "hash"      // å“ˆå¸Œå€¼: a1b2c3...
    MaskRange   MaskAction = "range"     // æ˜¾ç¤ºèŒƒå›´: 10000-50000
    MaskNone    MaskAction = "none"      // ä¸è„±æ•
)
```

### 3. å®¡è®¡æ—¥å¿—

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å®¡è®¡é…ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.Configure(goorm.Config{
    Audit: goorm.AuditConfig{
        Enabled:   true,
        LogTable:  "_goorm_audit",         // å®¡è®¡è¡¨å
        LogFile:   "./logs/goorm_audit.log",  // åŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶
        
        // è®°å½•çº§åˆ«
        Level: goorm.AuditAll,  // æˆ– AuditWrite, AuditDestructive
        
        // è®°å½•å†…å®¹
        LogSQL:        true,   // è®°å½• SQL
        LogParams:     true,   // è®°å½•å‚æ•°ï¼ˆæ•æ„Ÿå­—æ®µä¼šè„±æ•ï¼‰
        LogResult:     false,  // ä¸è®°å½•è¿”å›ç»“æœï¼ˆå¯èƒ½å¤ªå¤§ï¼‰
        LogDuration:   true,   // è®°å½•æ‰§è¡Œæ—¶é—´
        
        // ä¿ç•™æ—¶é—´
        RetentionDays: 90,     // 90å¤©åè‡ªåŠ¨æ¸…ç†
    },
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å®¡è®¡è®°å½•ç»“æ„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
{
    "id": 12345,
    "timestamp": "2026-02-03T15:22:00Z",
    "operation": "delete",
    "table": "users",
    
    // æ¥æºä¿¡æ¯
    "source": "nl_query",           // nl_query / api / mcp
    "source_input": "åˆ é™¤æ‰€æœ‰3å¹´æœªç™»å½•çš„ç”¨æˆ·",
    
    // æ‰§è¡Œä¿¡æ¯
    "sql": "DELETE FROM users WHERE created_at < $1 AND login_count = $2",
    "params": ["2023-02-03", 0],
    "affected_rows": 1234,
    "duration_ms": 45,
    
    // ç¡®è®¤ä¿¡æ¯
    "required_confirm": true,
    "confirm_token": "cfm_abc123",
    "confirmed_at": "2026-02-03T15:22:30Z",
    
    // å¤‡ä»½ä¿¡æ¯
    "backup_created": true,
    "backup_table": "_backup_users_20260203_152200",
    
    // è°ƒç”¨è€…ä¿¡æ¯
    "caller_type": "ai_agent",
    "caller_id": "claude-3",
    "ip_address": "192.168.1.100",
    
    // çŠ¶æ€
    "status": "success",
    "error": null
}
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æŸ¥è¯¢å®¡è®¡æ—¥å¿—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

logs := db.Audit.Query(goorm.AuditQuery{
    Since:      time.Now().AddDate(0, 0, -7),  // æœ€è¿‘7å¤©
    Operations: []string{"delete", "update"},  // åªçœ‹åˆ é™¤å’Œæ›´æ–°
    Table:      "users",                       // åªçœ‹ users è¡¨
    Status:     "success",
})
```

### 4. æ“ä½œç¬¦æšä¸¾åŒ–ï¼ˆç±»å‹å®‰å…¨ï¼‰

**é¿å…å­—ç¬¦ä¸²æ“ä½œç¬¦å¸¦æ¥çš„é”™è¯¯ï¼š**

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ“ä½œç¬¦å®šä¹‰ï¼ˆç±»å‹å®‰å…¨ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type Op string

const (
    // æ¯”è¾ƒæ“ä½œç¬¦
    Eq  Op = "="        // ç­‰äº
    Ne  Op = "!="       // ä¸ç­‰äº
    Gt  Op = ">"        // å¤§äº
    Gte Op = ">="       // å¤§äºç­‰äº
    Lt  Op = "<"        // å°äº
    Lte Op = "<="       // å°äºç­‰äº
    
    // èŒƒå›´æ“ä½œç¬¦
    In      Op = "IN"           // åœ¨åˆ—è¡¨ä¸­
    NotIn   Op = "NOT IN"       // ä¸åœ¨åˆ—è¡¨ä¸­
    Between Op = "BETWEEN"      // èŒƒå›´å†…
    
    // å­—ç¬¦ä¸²æ“ä½œç¬¦
    Like     Op = "LIKE"        // æ¨¡ç³ŠåŒ¹é…
    NotLike  Op = "NOT LIKE"    // ä¸åŒ¹é…
    ILike    Op = "ILIKE"       // å¿½ç•¥å¤§å°å†™ï¼ˆPostgreSQLï¼‰
    Regex    Op = "~"           // æ­£åˆ™åŒ¹é…
    
    // NULL æ“ä½œç¬¦
    IsNull    Op = "IS NULL"
    IsNotNull Op = "IS NOT NULL"
    
    // JSON æ“ä½œç¬¦ï¼ˆPostgreSQLï¼‰
    JsonContains    Op = "@>"   // JSON åŒ…å«
    JsonContainedBy Op = "<@"   // è¢« JSON åŒ…å«
    JsonHasKey      Op = "?"    // æœ‰æŸä¸ª key
    JsonHasAnyKey   Op = "?|"   // æœ‰ä»»æ„ä¸€ä¸ª key
    JsonHasAllKeys  Op = "?&"   // æœ‰æ‰€æœ‰ key
)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ä½¿ç”¨ç¤ºä¾‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ æ—§æ–¹å¼ï¼ˆå®¹æ˜“å‡ºé”™ï¼‰
{Field: "age", Op: ">", Value: 18}      // ">" è¿˜æ˜¯ "gt"ï¼Ÿ
{Field: "name", Op: "like", Value: "%å¼ %"}  // "like" è¿˜æ˜¯ "LIKE"ï¼Ÿ

// âœ… æ–°æ–¹å¼ï¼ˆç±»å‹å®‰å…¨ï¼‰
{Field: "age", Op: goorm.Gt, Value: 18}
{Field: "name", Op: goorm.Like, Value: "%å¼ %"}
{Field: "status", Op: goorm.In, Value: []string{"active", "pending"}}
{Field: "deleted_at", Op: goorm.IsNull}
{Field: "tags", Op: goorm.JsonContains, Value: `["go", "database"]`}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// åµŒå¥—æ¡ä»¶æ”¯æŒï¼ˆAND/OR ç»„åˆï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// å¤æ‚æ¡ä»¶ï¼š(age > 18 AND status = 'active') OR (vip = true)
users := goorm.Query[User](db).
    WhereStruct(goorm.Conditions{
        goorm.Or{
            goorm.And{
                {Field: "age", Op: goorm.Gt, Value: 18},
                {Field: "status", Op: goorm.Eq, Value: "active"},
            },
            goorm.And{
                {Field: "vip", Op: goorm.Eq, Value: true},
            },
        },
    }).
    All()

// ç­‰ä»·çš„ JSON æ ¼å¼ï¼ˆAI ç”Ÿæˆï¼‰
goorm.QueryJSON[User](db, `{
    "where": {
        "or": [
            {
                "and": [
                    {"field": "age", "op": ">", "value": 18},
                    {"field": "status", "op": "=", "value": "active"}
                ]
            },
            {
                "and": [
                    {"field": "vip", "op": "=", "value": true}
                ]
            }
        ]
    }
}`)
```

### 5. é”™è¯¯ä¿¡æ¯åŒ…å«ä¿®å¤å»ºè®®

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¢å¼ºçš„é”™è¯¯ç»“æ„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type GoormError struct {
    Code       string            `json:"code"`
    Message    string            `json:"message"`
    Details    map[string]any    `json:"details"`
    Suggestion string            `json:"suggestion"`
    AutoFix    *AutoFixAction    `json:"auto_fix,omitempty"`
}

type AutoFixAction struct {
    Action      string `json:"action"`       // æ“ä½œç±»å‹
    Description string `json:"description"`  // æ“ä½œæè¿°
    Query       string `json:"query"`        // å»ºè®®çš„ SQL
    Safe        bool   `json:"safe"`         // æ˜¯å¦å®‰å…¨è‡ªåŠ¨æ‰§è¡Œ
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é”™è¯¯ç¤ºä¾‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ç¤ºä¾‹1ï¼šå¤–é”®çº¦æŸå¤±è´¥
err := goorm.Create[Order](db, &Order{UserID: 999, Amount: 100})
/*
{
    "code": "FK_VIOLATION",
    "message": "å¤–é”®çº¦æŸå¤±è´¥: user_id = 999 åœ¨ users è¡¨ä¸­ä¸å­˜åœ¨",
    "details": {
        "table": "orders",
        "field": "user_id",
        "value": 999,
        "references": "users.id"
    },
    "suggestion": "å…ˆåˆ›å»ºç”¨æˆ·ï¼Œæˆ–ä½¿ç”¨å·²å­˜åœ¨çš„ç”¨æˆ· ID",
    "auto_fix": {
        "action": "create_related",
        "description": "åˆ›å»º ID ä¸º 999 çš„ç”¨æˆ·",
        "query": "INSERT INTO users (id, name) VALUES (999, 'Unknown')",
        "safe": false
    }
}
*/

// ç¤ºä¾‹2ï¼šå”¯ä¸€çº¦æŸå¤±è´¥
/*
{
    "code": "UNIQUE_VIOLATION",
    "message": "å”¯ä¸€çº¦æŸå¤±è´¥: email = 'test@example.com' å·²å­˜åœ¨",
    "details": {
        "table": "users",
        "field": "email",
        "value": "test@example.com",
        "existing_id": 42
    },
    "suggestion": "ä½¿ç”¨å…¶ä»–é‚®ç®±ï¼Œæˆ–æ›´æ–°ç°æœ‰ç”¨æˆ·",
    "auto_fix": {
        "action": "update_instead",
        "description": "æ›´æ–°ç°æœ‰ç”¨æˆ·è€Œéæ’å…¥",
        "query": "UPDATE users SET name = 'æ–°åå­—' WHERE id = 42",
        "safe": false
    }
}
*/

// ç¤ºä¾‹3ï¼šæšä¸¾å€¼é”™è¯¯
/*
{
    "code": "ENUM_VIOLATION",
    "message": "æ— æ•ˆçš„æšä¸¾å€¼: status = 'actve'",
    "details": {
        "table": "users",
        "field": "status",
        "value": "actve",
        "allowed_values": ["active", "inactive", "banned"]
    },
    "suggestion": "ä½ æ˜¯å¦æƒ³è¾“å…¥ 'active'ï¼Ÿ",
    "auto_fix": {
        "action": "correct_typo",
        "description": "å°† 'actve' æ”¹ä¸º 'active'",
        "query": "åŸæŸ¥è¯¢ä¸­å°† 'actve' æ›¿æ¢ä¸º 'active'",
        "safe": true
    }
}
*/
```

---

## å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ (MVP)

**ç›®æ ‡ï¼š** å¯ç”¨çš„æœ€å°äº§å“

```
Week 1-2:
â”œâ”€â”€ [ ] æ•°æ®åº“è¿æ¥ç®¡ç†
â”œâ”€â”€ [ ] æ¨¡å‹æ³¨å†Œä¸ Schema è§£æ
â”œâ”€â”€ [ ] PostgreSQL æ–¹è¨€åŸºç¡€å®ç°
â””â”€â”€ [ ] åŸºç¡€ CRUD (Create, Find, Update, Delete)

Week 3-4:
â”œâ”€â”€ [ ] MySQL æ–¹è¨€åŸºç¡€å®ç°
â”œâ”€â”€ [ ] é“¾å¼æŸ¥è¯¢ (Where, OrderBy, Limit)
â””â”€â”€ [ ] äº‹åŠ¡æ”¯æŒ
```

### Phase 2: è¿ç§»ç³»ç»Ÿ

**ç›®æ ‡ï¼š** è§£å†³æ ¸å¿ƒç—›ç‚¹

```
Week 5-6:
â”œâ”€â”€ [ ] Schema Diff å¯¹æ¯”å¼•æ“
â”œâ”€â”€ [ ] è¡¨/åˆ—çš„åˆ›å»ºå’Œåˆ é™¤
â”œâ”€â”€ [ ] è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
â””â”€â”€ [ ] è¿ç§»å†å²è®°å½•

Week 7-8:
â”œâ”€â”€ [ ] å­—æ®µç±»å‹å˜æ›´æ£€æµ‹
â”œâ”€â”€ [ ] ç´¢å¼•ç®¡ç†
â”œâ”€â”€ [ ] è¿ç§»å›æ»š
â””â”€â”€ [ ] CLI å·¥å…·
```

### Phase 3: å…³è”å…³ç³»

**ç›®æ ‡ï¼š** ç®€åŒ–å¤æ‚æŸ¥è¯¢

```
Week 9-10:
â”œâ”€â”€ [ ] has_one / has_many å…³è”
â”œâ”€â”€ [ ] belongs_to å…³è”
â”œâ”€â”€ [ ] å…³è”é¢„åŠ è½½ (With)
â””â”€â”€ [ ] åµŒå¥—å…³è”

Week 11-12:
â”œâ”€â”€ [ ] many_to_many å…³è”
â”œâ”€â”€ [ ] å…³è”æ¡ä»¶è¿‡æ»¤
â”œâ”€â”€ [ ] å…³è”æ“ä½œ (Attach/Detach/Sync)
â””â”€â”€ [ ] Has / WhereHas æŸ¥è¯¢
```

### Phase 4: AI èƒ½åŠ› â­

**ç›®æ ‡ï¼š** AI åŸç”Ÿç‰¹æ€§

```
Week 13-14:
â”œâ”€â”€ [ ] Schema è‡ªæè¿°ç³»ç»Ÿ
â”œâ”€â”€ [ ] å…ƒæ•°æ®æ ‡ç­¾è§£æï¼ˆsensitive, searchable, etc.ï¼‰
â”œâ”€â”€ [ ] æ•æ„Ÿæ•°æ®è„±æ•
â””â”€â”€ [ ] ç»“æ„åŒ–æŸ¥è¯¢ï¼ˆWhereStruct, QueryJSONï¼‰

Week 15-16:
â”œâ”€â”€ [ ] æ“ä½œç¬¦æšä¸¾åŒ–
â”œâ”€â”€ [ ] åµŒå¥—æ¡ä»¶æ”¯æŒï¼ˆAND/ORï¼‰
â”œâ”€â”€ [ ] å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
â””â”€â”€ [ ] ç¡®è®¤æœºåˆ¶ï¼ˆå±é™©æ“ä½œï¼‰

Week 17-18:
â”œâ”€â”€ [ ] MCP å·¥å…·åè®®å®ç°
â”œâ”€â”€ [ ] è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ¥å£
â”œâ”€â”€ [ ] å‘é‡æœç´¢æ”¯æŒï¼ˆpgvectorï¼‰
â””â”€â”€ [ ] AI è¾…åŠ©åŠŸèƒ½ï¼ˆç´¢å¼•å»ºè®®ç­‰ï¼‰
```

### Phase 5: ç”Ÿäº§å°±ç»ª

**ç›®æ ‡ï¼š** ä¼ä¸šçº§å¯ç”¨

```
Week 19-22:
â”œâ”€â”€ [ ] å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ [ ] æ€§èƒ½ä¼˜åŒ–å’ŒåŸºå‡†æµ‹è¯•
â”œâ”€â”€ [ ] è¯¦ç»†æ–‡æ¡£å’Œç¤ºä¾‹
â”œâ”€â”€ [ ] Hooksï¼ˆBeforeCreate, AfterDelete ç­‰ï¼‰
â”œâ”€â”€ [ ] è½¯åˆ é™¤
â”œâ”€â”€ [ ] æ—¥å¿—å’Œè°ƒè¯•
â”œâ”€â”€ [ ] è¿æ¥æ± ä¼˜åŒ–
â”œâ”€â”€ [ ] é”™è¯¯å¤„ç†å¢å¼ºï¼ˆAutoFix å»ºè®®ï¼‰
â””â”€â”€ [ ] å®‰å…¨å®¡æŸ¥å’ŒåŠ å›º
```

---

## è®¾è®¡å†³ç­–

ä»¥ä¸‹æ˜¯å·²ç¡®å®šçš„æ ¸å¿ƒè®¾è®¡å†³ç­–ï¼š

---

### 1. API é£æ ¼ï¼šAI å‹å¥½çš„æ³›å‹ + é“¾å¼è°ƒç”¨ âœ…

**é€‰æ‹©ç†ç”±ï¼š**
- æ³›å‹æ–¹æ³•æ— éœ€ä»£ç ç”Ÿæˆï¼Œé¡¹ç›®æ›´ç®€æ´
- ç»“æ„åŒ–å‚æ•°ä¾¿äº AI ç”Ÿæˆå’Œç†è§£
- é“¾å¼è°ƒç”¨å¯è¯»æ€§å¼ºï¼ŒAI å¯ä»¥è½»æ¾ç»„åˆæ¡ä»¶

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ ¸å¿ƒ API é£æ ¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åŸºç¡€ CRUD - æ³›å‹æ–¹æ³•
user := goorm.Find[User](db, 1)
user := goorm.Create[User](db, &User{Name: "å¼ ä¸‰"})
goorm.Update[User](db, 1, map[string]any{"name": "æå››"})
goorm.Delete[User](db, 1)

// é“¾å¼æŸ¥è¯¢ - è¿”å›ç±»å‹å®‰å…¨çš„ç»“æœ
users := goorm.Query[User](db).
    Where("age > ?", 18).
    Where("status = ?", "active").
    OrderBy("created_at DESC").
    Limit(10).
    All()

// å…³è”åŠ è½½
user := goorm.Query[User](db).
    With("Posts", "Profile").
    Find(1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI å‹å¥½çš„ç»“æ„åŒ–æŸ¥è¯¢ï¼ˆæ¨èç»™ AI ä½¿ç”¨ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ–¹å¼ä¸€ï¼šè‡ªç„¶è¯­è¨€
result := db.NL("æŸ¥æ‰¾æ‰€æœ‰å¹´é¾„å¤§äº18å²çš„VIPç”¨æˆ·")

// æ–¹å¼äºŒï¼šç»“æ„åŒ–æ¡ä»¶ï¼ˆAI æœ€å®¹æ˜“ç”Ÿæˆï¼‰
users := goorm.Query[User](db).
    WhereStruct(goorm.Conditions{
        {Field: "age", Op: ">", Value: 18},
        {Field: "status", Op: "=", Value: "active"},
        {Field: "created_at", Op: ">=", Value: "2024-01-01"},
    }).
    OrderByStruct(goorm.Orders{
        {Field: "created_at", Desc: true},
    }).
    Limit(10).
    All()

// æ–¹å¼ä¸‰ï¼šJSON æŸ¥è¯¢ï¼ˆä» AI ç›´æ¥æ¥æ”¶ï¼‰
users := goorm.QueryJSON[User](db, `{
    "where": [
        {"field": "age", "op": ">", "value": 18},
        {"field": "status", "op": "=", "value": "active"}
    ],
    "orderBy": [{"field": "created_at", "desc": true}],
    "limit": 10
}`)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ‰¹é‡æ“ä½œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

goorm.CreateBatch[User](db, users)
goorm.Query[User](db).Where("status = ?", "inactive").UpdateAll(map[string]any{"deleted": true})
goorm.Query[User](db).Where("deleted = ?", true).DeleteAll()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// äº‹åŠ¡ - å‡½æ•°å¼ï¼ˆæ¨èï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

err := db.Transaction(func(tx *goorm.Tx) error {
    goorm.Create[User](tx, &User{Name: "å¼ ä¸‰"})
    goorm.Create[Order](tx, &Order{UserID: 1, Amount: 100})
    return nil  // è¿”å› nil æäº¤ï¼Œè¿”å› error å›æ»š
})
```

---

### 2. è¿ç§»å®‰å…¨çº§åˆ«ï¼šæ¿€è¿›æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ âœ…

**é€‰æ‹©ç†ç”±ï¼š**
- ä¿æŒæ•°æ®åº“ä¸æ¨¡å‹ 100% ä¸€è‡´æ˜¯æ ¸å¿ƒä»·å€¼
- å¤‡ä»½æœºåˆ¶ç¡®ä¿æ•°æ®å®‰å…¨
- å¼€å‘æ•ˆç‡ä¼˜å…ˆï¼Œç”Ÿäº§ç¯å¢ƒå¯åˆ‡æ¢ä¿å®ˆæ¨¡å¼

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é»˜è®¤è¡Œä¸ºï¼šæ¿€è¿›æ¨¡å¼ï¼ŒåŒæ—¶è‡ªåŠ¨å¤‡ä»½
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.AutoSync()  // è‡ªåŠ¨åŒæ­¥ï¼Œåˆ é™¤çš„è¡¨/åˆ—ä¼šå…ˆå¤‡ä»½å†åˆ é™¤

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¯é…ç½®çš„å®‰å…¨çº§åˆ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ¿€è¿›æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰- è‡ªåŠ¨åˆ é™¤ä¸éœ€è¦çš„ï¼Œä½†å…ˆå¤‡ä»½
db.AutoSync(goorm.SyncConfig{
    Mode: goorm.Aggressive,  // é»˜è®¤å€¼
})

// ä¿å®ˆæ¨¡å¼ - åªæ·»åŠ ï¼Œä¸åˆ é™¤
db.AutoSync(goorm.SyncConfig{
    Mode: goorm.Conservative,
})

// åªè¯»æ¨¡å¼ - åªé¢„è§ˆï¼Œä¸æ‰§è¡Œ
diff := db.AutoSync(goorm.SyncConfig{
    Mode: goorm.DryRun,
})
fmt.Println(diff.SQL())      // æŸ¥çœ‹å°†è¦æ‰§è¡Œçš„ SQL
fmt.Println(diff.Summary())  // æŸ¥çœ‹å˜æ›´æ‘˜è¦

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if os.Getenv("ENV") == "production" {
    db.AutoSync(goorm.SyncConfig{
        Mode:            goorm.Conservative,  // ç”Ÿäº§ç¯å¢ƒä¿å®ˆæ¨¡å¼
        RequireConfirm:  true,                // ç ´åæ€§æ“ä½œéœ€è¦ç¡®è®¤
        NotifyOnChange:  true,                // å‘é€å˜æ›´é€šçŸ¥
    })
}
```

---

### 3. å¤‡ä»½ç­–ç•¥ï¼šåŒåº“å¤‡ä»½è¡¨ï¼ˆå¯é…ç½®ï¼‰ âœ…

**é€‰æ‹©ç†ç”±ï¼š**
- åŒåº“å¤‡ä»½æœ€ç®€å•ï¼Œæ— éœ€é¢å¤–é…ç½®
- å¤‡ä»½è¡¨æ˜“äºæŸ¥è¯¢å’Œæ¢å¤
- å¯é…ç½®å…¶ä»–å¤‡ä»½æ–¹å¼æ»¡è¶³ä¸åŒéœ€æ±‚

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é»˜è®¤å¤‡ä»½é…ç½®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.AutoSync()  // é»˜è®¤ä½¿ç”¨åŒåº“å¤‡ä»½è¡¨

// å¤‡ä»½è¡¨å‘½åè§„åˆ™: _backup_{è¡¨å}_{å­—æ®µå}_{æ—¶é—´æˆ³}
// ä¾‹å¦‚: _backup_users_phone_20260203_151725

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¤‡ä»½é…ç½®é€‰é¡¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.Configure(goorm.Config{
    Backup: goorm.BackupConfig{
        // å¤‡ä»½å­˜å‚¨æ–¹å¼
        Storage: goorm.BackupInTable,  // é»˜è®¤ï¼šåŒåº“å¤‡ä»½è¡¨
        // Storage: goorm.BackupToFile,   // å¯¼å‡º SQL æ–‡ä»¶
        // Storage: goorm.BackupToDB,     // ç‹¬ç«‹å¤‡ä»½æ•°æ®åº“
        
        // å¤‡ä»½è¡¨å‰ç¼€
        TablePrefix: "_backup_",  // é»˜è®¤
        
        // å¤‡ä»½æ–‡ä»¶ç›®å½•ï¼ˆå½“ Storage = BackupToFile æ—¶ï¼‰
        FilePath: "./backups/",
        
        // å¤‡ä»½ä¿ç•™æ—¶é—´
        RetentionDays: 30,  // 30å¤©åè‡ªåŠ¨æ¸…ç†å¤‡ä»½ï¼Œ0 = æ°¸ä¸æ¸…ç†
        
        // å¤‡ä»½å‰æ˜¯å¦å‹ç¼©ï¼ˆä»…æ–‡ä»¶å¤‡ä»½ï¼‰
        Compress: true,
    },
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¤‡ä»½ç®¡ç†
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åˆ—å‡ºæ‰€æœ‰å¤‡ä»½
backups := db.Backup.List()
/*
[
  {
    "name": "_backup_users_phone_20260203_151725",
    "table": "users",
    "column": "phone",
    "created_at": "2026-02-03T15:17:25Z",
    "row_count": 1234,
    "size_bytes": 45678
  },
  ...
]
*/

// æ¢å¤å¤‡ä»½
db.Backup.Restore("_backup_users_phone_20260203_151725")

// æ‰‹åŠ¨æ¸…ç†æ—§å¤‡ä»½
db.Backup.CleanupBefore(time.Now().AddDate(0, -1, 0))  // æ¸…ç†1ä¸ªæœˆå‰çš„å¤‡ä»½

// å¯¼å‡ºå¤‡ä»½ä¸º SQL
sql := db.Backup.ExportSQL("_backup_users_phone_20260203_151725")
```

---

### 4. å‘½åçº¦å®šï¼šAI å‹å¥½çš„ snake_case âœ…

**é€‰æ‹©ç†ç”±ï¼š**
- `snake_case` æ˜¯ SQL æ ‡å‡†ï¼ŒAI ç”Ÿæˆ SQL æ›´å‡†ç¡®
- å¤æ•°è¡¨åæ›´ç¬¦åˆè¯­ä¹‰ï¼ˆusers æ˜¯ç”¨æˆ·çš„é›†åˆï¼‰
- ä¸€è‡´çš„å‘½åè®© AI æ›´å®¹æ˜“ç†è§£å’Œç”Ÿæˆ

```go
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å‘½åçº¦å®š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Go ç»“æ„ä½“                â†’  æ•°æ®åº“è¡¨/å­—æ®µ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// User                    â†’  users          (å¤æ•° + snake_case)
// OrderItem               â†’  order_items
// UserProfile             â†’  user_profiles
//
// Name string             â†’  name           (å°å†™)
// CreatedAt time.Time     â†’  created_at     (snake_case)
// UserID uint             â†’  user_id        (snake_case)
// IsVIP bool              â†’  is_vip         (snake_case)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ¨¡å‹å®šä¹‰ç¤ºä¾‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type User struct {
    goorm.Model                              // åŒ…å« id, created_at, updated_at
    Name      string    `json:"name"`        // â†’ name
    Email     string    `json:"email"`       // â†’ email
    IsVIP     bool      `json:"is_vip"`      // â†’ is_vip
    LoginCount int      `json:"login_count"` // â†’ login_count
    LastLoginAt *time.Time `json:"last_login_at"` // â†’ last_login_at
}
// è¡¨å: users

type OrderItem struct {
    goorm.Model
    OrderID   uint      `json:"order_id"`    // â†’ order_id
    ProductID uint      `json:"product_id"`  // â†’ product_id
    Quantity  int       `json:"quantity"`    // â†’ quantity
    UnitPrice float64   `json:"unit_price"`  // â†’ unit_price
}
// è¡¨å: order_items

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å‘½åé…ç½®ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db.Configure(goorm.Config{
    Naming: goorm.NamingConfig{
        // è¡¨åç­–ç•¥
        TableNamer: goorm.SnakeCasePlural,  // é»˜è®¤: User â†’ users
        // TableNamer: goorm.SnakeCaseSingular, // User â†’ user
        // TableNamer: goorm.AsIs,              // User â†’ User
        
        // å­—æ®µåç­–ç•¥  
        ColumnNamer: goorm.SnakeCase,  // é»˜è®¤: UserID â†’ user_id
        // ColumnNamer: goorm.CamelCase,  // UserID â†’ userId
        
        // è¡¨å‰ç¼€
        TablePrefix: "",  // é»˜è®¤æ— å‰ç¼€ï¼Œå¯è®¾ç½®å¦‚ "app_"
        
        // ä¸»é”®å­—æ®µå
        PrimaryKey: "id",  // é»˜è®¤
        
        // æ—¶é—´å­—æ®µå
        CreatedAtField: "created_at",  // é»˜è®¤
        UpdatedAtField: "updated_at",  // é»˜è®¤
        DeletedAtField: "deleted_at",  // è½¯åˆ é™¤å­—æ®µï¼Œé»˜è®¤
    },
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è‡ªå®šä¹‰è¡¨åï¼ˆä¸‰ç§æ–¹å¼ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ–¹å¼ä¸€ï¼šå®ç° TableName æ–¹æ³•
type User struct {
    goorm.Model
    Name string
}

func (User) TableName() string {
    return "sys_users"  // è‡ªå®šä¹‰è¡¨å
}
// JQL ä¸­ä½¿ç”¨: {"table": "sys_users", ...}

// æ–¹å¼äºŒï¼šä½¿ç”¨æ ‡ç­¾
type Order struct {
    goorm.Model `table:"t_orders"`  // ç›´æ¥åœ¨æ ‡ç­¾ä¸­æŒ‡å®š
    Amount float64
}
// JQL ä¸­ä½¿ç”¨: {"table": "t_orders", ...}

// æ–¹å¼ä¸‰ï¼šæ³¨å†Œæ—¶æŒ‡å®š
db.Register(&User{}, goorm.WithTableName("custom_users"))
// JQL ä¸­ä½¿ç”¨: {"table": "custom_users", ...}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI å¦‚ä½•å‘ç°è¡¨åï¼Ÿï¼ˆSchema å‘ç° APIï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œçš„è¡¨
result := db.Execute(`{
    "action": "list_tables"
}`)
/*
å“åº”ï¼š
{
    "success": true,
    "tables": [
        {
            "name": "users",
            "model": "User",
            "description": "ç³»ç»Ÿç”¨æˆ·è¡¨",
            "columns": ["id", "name", "email", "age", "created_at", "updated_at"],
            "primary_key": "id"
        },
        {
            "name": "orders",
            "model": "Order",
            "description": "è®¢å•è¡¨",
            "columns": ["id", "user_id", "amount", "status", "created_at"],
            "primary_key": "id"
        }
    ]
}
*/

// è·å–è¡¨çš„è¯¦ç»† Schema
result := db.Execute(`{
    "action": "describe",
    "table": "users"
}`)
/*
å“åº”ï¼š
{
    "success": true,
    "schema": {
        "table": "users",
        "model": "User",
        "description": "ç³»ç»Ÿç”¨æˆ·è¡¨",
        "columns": [
            {"name": "id", "type": "bigint", "primary": true},
            {"name": "name", "type": "varchar(255)", "nullable": false, "desc": "ç”¨æˆ·å§“å"},
            {"name": "email", "type": "varchar(255)", "unique": true, "desc": "ç”¨æˆ·é‚®ç®±"},
            {"name": "age", "type": "integer", "nullable": true, "desc": "å¹´é¾„"},
            {"name": "created_at", "type": "timestamp", "default": "now()"}
        ],
        "indexes": [
            {"name": "idx_users_email", "columns": ["email"], "unique": true}
        ],
        "relations": [
            {"name": "posts", "type": "has_many", "target": "posts", "fk": "user_id"},
            {"name": "profile", "type": "has_one", "target": "profiles", "fk": "user_id"}
        ]
    }
}
*/

// è‡ªç„¶è¯­è¨€å‘ç°
result := db.NL("æ•°æ®åº“é‡Œæœ‰å“ªäº›è¡¨ï¼Ÿ")
// â†’ è¿”å›æ‰€æœ‰è¡¨çš„åˆ—è¡¨å’Œæè¿°

result := db.NL("users è¡¨æœ‰å“ªäº›å­—æ®µï¼Ÿ")
// â†’ è¿”å› users è¡¨çš„ Schema

// MCP å·¥å…·ä¹Ÿæä¾› list_tables å’Œ describe_table
// AI Agent å¯ä»¥å…ˆå‘ç°è¡¨ç»“æ„ï¼Œå†æ‰§è¡ŒæŸ¥è¯¢


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI å‹å¥½ï¼šå­—æ®µæè¿°è‡ªåŠ¨è½¬ä¸ºè¡¨æ³¨é‡Š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type User struct {
    goorm.Model `desc:"ç³»ç»Ÿç”¨æˆ·è¡¨ï¼Œå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯"`
    
    Name  string `json:"name" desc:"ç”¨æˆ·å§“åï¼Œæ”¯æŒä¸­è‹±æ–‡" example:"å¼ ä¸‰"`
    Email string `json:"email" desc:"ç”¨æˆ·é‚®ç®±ï¼Œå”¯ä¸€æ ‡è¯†" format:"email"`
    Age   int    `json:"age" desc:"å¹´é¾„" min:"0" max:"150"`
}

// è‡ªåŠ¨ç”Ÿæˆçš„ DDL åŒ…å«æ³¨é‡Š:
// CREATE TABLE users (
//   id BIGSERIAL PRIMARY KEY,
//   name VARCHAR(255) NOT NULL COMMENT 'ç”¨æˆ·å§“åï¼Œæ”¯æŒä¸­è‹±æ–‡',
//   email VARCHAR(255) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·é‚®ç®±ï¼Œå”¯ä¸€æ ‡è¯†',
//   age INTEGER COMMENT 'å¹´é¾„',
//   created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
//   updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
// ) COMMENT 'ç³»ç»Ÿç”¨æˆ·è¡¨ï¼Œå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯';
```

---

### è®¾è®¡å†³ç­–æ€»ç»“

| å†³ç­–é¡¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| API é£æ ¼ | **æ³›å‹ + é“¾å¼ + ç»“æ„åŒ–** | ç±»å‹å®‰å…¨ï¼ŒAI æ˜“ç”Ÿæˆ |
| è¿ç§»æ¨¡å¼ | **æ¿€è¿›æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰** | ä¿æŒæ•°æ®åº“å¹²å‡€ï¼Œå¤‡ä»½ç¡®ä¿å®‰å…¨ |
| å¤‡ä»½æ–¹å¼ | **åŒåº“å¤‡ä»½è¡¨ï¼ˆå¯é…ç½®ï¼‰** | ç®€å•æ˜“ç”¨ï¼Œå¯æ‰©å±• |
| å‘½åçº¦å®š | **snake_case å¤æ•°** | SQL æ ‡å‡†ï¼ŒAI å‹å¥½ |

---

## å‚è€ƒé¡¹ç›®

- **GORM** - Go æœ€æµè¡Œçš„ ORMï¼Œä½†è¿ç§»åŠŸèƒ½å¼±
- **Ent** - Facebook å‡ºå“ï¼ŒåŠŸèƒ½å¼ºä½†å¤æ‚
- **SQLC** - SQL ä¼˜å…ˆï¼Œä½†ä¸æ˜¯ ORM
- **Prisma** - Node.js æœ€ä½³å®è·µï¼Œå£°æ˜å¼ Schema
- **Rails ActiveRecord** - Ruby ä¸–ç•Œçš„æ ‡æ†
- **Django ORM** - Python ä¸–ç•Œçš„æ ‡æ†

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv0.5*  
*åˆ›å»ºæ—¶é—´ï¼š2026-02-03*  
*æ›´æ–°æ—¶é—´ï¼š2026-02-03*  
*æ›´æ–°å†…å®¹ï¼šè¡¥å…… P0 åŠŸèƒ½ï¼ˆäº‹åŠ¡ JQL åŒ–ã€Context æ”¯æŒã€æŸ¥è¯¢è§£é‡Š/è°ƒè¯•ï¼‰*



